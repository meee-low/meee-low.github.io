import{s as J,n as z,c as oe,r as de,e as fe,o as he}from"../chunks/scheduler.D5QpUS1r.js";import{S as Q,i as X,e as k,c as b,r as m,d as l,a as d,b as L,q as P,u as V,w as i,x as j,s as A,v as T,y as I,l as N,m as G,g as ke,A as be,n as W,B as ee,t as U,j as Y,o as q}from"../chunks/index.B8cwJtvF.js";import{w as pe}from"../chunks/index.DdhBeCJx.js";const ie=3,me=10,ce=14,ve=100/ce,_e=ie/10,ye=3;let Z=pe({playerOneState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},playerTwoState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},globals:{roundCount:0,roundFrameCount:0,frozenFramesLeft:0,frozenReason:"",paused:!0}});function ge(e){if(e.playerOneState.attackCharge<100&&e.playerTwoState.attackCharge<100)return e;if(e.playerOneState.attackCharge>=100&&e.playerTwoState.attackCharge>=100)return e;let t=e.playerOneState.attackCharge>e.playerTwoState.attackCharge?1:2;return e=we(e,t),e}function te(e,t){if(t===1)return e.playerOneState;if(t===2)return e.playerTwoState;throw new Error("Invalid player id. Only 2 people play this game.")}function we(e,t){let s=te(e,t),r=te(e,t%2+1);return r.parryFrames>0?(r.score+=1,e=S(e)):r.status==="blocking"&&r.blockStamina>=0?r.blockStamina=Math.max(0,r.blockStamina-me):r.status==="neutral"&&(s.score+=1,e=S(e)),s.attackCharge=0,e}function Fe(e){return e.keysHeld.has("def")&&e.keysHeld.has("atk")||!e.keysHeld.has("def")&&!e.keysHeld.has("atk")?(e.status="neutral",e.attackCharge=0):e.keysHeld.has("atk")?e.status="attacking":e.keysHeld.has("def")&&(e.attackCharge=0,e.status!=="blocking"&&(e.parryFrames=ye),e.blockStamina>0&&e.blockForbiddenFramesLeft===0?e.status="blocking":e.status="neutral"),e}function ue(e,t,s){return["a","A","d","D","ArrowLeft","ArrowRight","p","P"].includes(t.key)&&(t.preventDefault(),e=s(e,t.key)),e}function $e(e,t){return ue(e,t,Te)}function Ae(e,t){return ue(e,t,Ce)}function Te(e,t){return t==="a"||t==="A"?e.playerOneState.keysHeld.add("def"):t==="d"||t==="D"?e.playerOneState.keysHeld.add("atk"):t==="ArrowLeft"?e.playerTwoState.keysHeld.add("atk"):t==="ArrowRight"?e.playerTwoState.keysHeld.add("def"):(t==="p"||t==="P")&&(e.globals.paused=!e.globals.paused),e}function Ce(e,t){return(t==="a"||t==="A")&&e.playerOneState.keysHeld.delete("def"),(t==="d"||t==="D")&&e.playerOneState.keysHeld.delete("atk"),t==="ArrowLeft"&&e.playerTwoState.keysHeld.delete("atk"),t==="ArrowRight"&&e.playerTwoState.keysHeld.delete("def"),e}function Ee(e){return e.status==="attacking"&&(e.attackCharge=Math.min(100,e.attackCharge+ve)),e}function Le(e){return e.status==="blocking"&&(e.blockStamina=Math.max(0,e.blockStamina-ie),e.blockStamina===0&&(e.blockForbiddenFramesLeft=2*ce-1)),e}function Re(e){return(e.keysHeld.has("atk")||!e.keysHeld.has("def"))&&(e.blockStamina=Math.min(100,e.blockStamina+_e)),e}function De(e){return e={...e,parryFrames:Math.max(0,e.parryFrames-1),blockForbiddenFramesLeft:Math.max(0,e.blockForbiddenFramesLeft-1),attackForbiddenFramesLeft:Math.max(0,e.attackForbiddenFramesLeft-1)},e}function re(e){return e={...e,status:"neutral",attackCharge:0,blockStamina:100,parryFrames:0},e}function S(e){return e={playerOneState:re(e.playerOneState),playerTwoState:re(e.playerTwoState),globals:{...e.globals,roundCount:e.globals.roundCount+1,roundFrameCount:0,frozenFramesLeft:60*3,frozenReason:"roundReset"}},e}function K(e,t){return e={...e,playerOneState:t(e.playerOneState),playerTwoState:t(e.playerTwoState)},e}function He(e){return e.globals.paused?e:e.globals.frozenFramesLeft>0?(--e.globals.frozenFramesLeft,e):(e.globals.frozenFramesLeft===0&&(e.globals.frozenReason=""),e=K(e,Fe),e=ge(e),e=K(e,Re),e=K(e,Ee),e=K(e,Le),e=K(e,De),e.globals.roundFrameCount+=1,e)}function se(e){let t,s;return{c(){t=k("p"),s=P(e[0]),this.h()},l(r){t=b(r,"P",{class:!0});var a=m(t);s=V(a,e[0]),a.forEach(l),this.h()},h(){d(t,"class","m-auto text-4xl")},m(r,a){L(r,t,a),i(t,s)},p(r,a){a&1&&j(s,r[0])},d(r){r&&l(t)}}}function Oe(e){let t,s=e[0]&&se(e);return{c(){t=k("div"),s&&s.c(),this.h()},l(r){t=b(r,"DIV",{class:!0});var a=m(t);s&&s.l(a),a.forEach(l),this.h()},h(){d(t,"class","absolute inset-0 flex h-full w-full items-center justify-center")},m(r,a){L(r,t,a),s&&s.m(t,null)},p(r,[a]){r[0]?s?s.p(r,a):(s=se(r),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},i:z,o:z,d(r){r&&l(t),s&&s.d()}}}function Me(e){return e.globals.paused?"(P)aused.":e.globals.frozenFramesLeft>0&&e.globals.frozenReason==="roundReset"?e.globals.frozenFramesLeft<=1?"Go!":""+Math.max(1,Math.round(e.globals.frozenFramesLeft/60)):null}function xe(e,t,s){let r,a;return oe(e,Z,c=>s(1,a=c)),e.$$.update=()=>{e.$$.dirty&2&&s(0,r=Me(a))},[r,a]}class Pe extends Q{constructor(t){super(),X(this,t,xe,Oe,J,{})}}function Ve(e){let t,s,r,a,c,f,p;return{c(){t=k("div"),s=k("div"),a=A(),c=k("div"),this.h()},l(h){t=b(h,"DIV",{class:!0});var o=m(t);s=b(o,"DIV",{class:!0,style:!0}),m(s).forEach(l),a=T(o),c=b(o,"DIV",{class:!0,style:!0}),m(c).forEach(l),o.forEach(l),this.h()},h(){d(s,"class",r=(e[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800"),I(s,"height",e[0].blockStamina+"%"),d(c,"class",f=(e[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800"),I(c,"height",e[0].attackCharge+"%"),d(t,"class",p=ne(e[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")},m(h,o){L(h,t,o),i(t,s),i(t,a),i(t,c)},p(h,[o]){o&1&&r!==(r=(h[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800")&&d(s,"class",r),o&1&&I(s,"height",h[0].blockStamina+"%"),o&1&&f!==(f=(h[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800")&&d(c,"class",f),o&1&&I(c,"height",h[0].attackCharge+"%"),o&1&&p!==(p=ne(h[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")&&d(t,"class",p)},i:z,o:z,d(h){h&&l(t)}}}function ne(e){return e==="blocking"||e==="blocking-start"?"bg-red-500":e==="attacking"?"bg-sky-500":"bg-yellow-400"}function Ie(e,t,s){let{playerState:r}=t;return e.$$set=a=>{"playerState"in a&&s(0,r=a.playerState)},[r]}class ae extends Q{constructor(t){super(),X(this,t,Ie,Ve,J,{playerState:0})}}function ze(e){let t,s,r,a,c=e[0].playerOneState.score+"",f,p,h,o=Math.round(e[0].globals.roundFrameCount/60)+"",R,w,y,D,_=e[0].playerTwoState.score+"",O,H,v,F,M,E;return{c(){t=k("div"),s=k("div"),r=k("p"),a=P("W:"),f=P(c),p=A(),h=k("p"),R=P(o),w=A(),y=k("p"),D=P("W:"),O=P(_),H=A(),v=k("div"),F=k("div"),M=A(),E=k("div"),this.h()},l(n){t=b(n,"DIV",{class:!0});var u=m(t);s=b(u,"DIV",{id:!0,class:!0});var g=m(s);r=b(g,"P",{class:!0});var $=m(r);a=V($,"W:"),f=V($,c),$.forEach(l),p=T(g),h=b(g,"P",{class:!0});var C=m(h);R=V(C,o),C.forEach(l),w=T(g),y=b(g,"P",{class:!0});var x=m(y);D=V(x,"W:"),O=V(x,_),x.forEach(l),g.forEach(l),H=T(u),v=b(u,"DIV",{class:!0});var B=m(v);F=b(B,"DIV",{class:!0,style:!0}),m(F).forEach(l),M=T(B),E=b(B,"DIV",{class:!0,style:!0}),m(E).forEach(l),B.forEach(l),u.forEach(l),this.h()},h(){d(r,"class","text-center"),d(h,"class","text-center"),d(y,"class","text-center"),d(s,"id","bar"),d(s,"class","grid w-full grid-cols-3"),d(F,"class","absolute h-10 w-6 bg-blue-500"),I(F,"left","calc("+le/6*100+"% - 12px)"),d(E,"class","absolute h-10 w-6 bg-orange-500"),I(E,"right","calc("+le/6*100+"% - 12px)"),d(v,"class","relative mx-8"),d(t,"class","min-h-20 w-full bg-gray-500 p-2")},m(n,u){L(n,t,u),i(t,s),i(s,r),i(r,a),i(r,f),i(s,p),i(s,h),i(h,R),i(s,w),i(s,y),i(y,D),i(y,O),i(t,H),i(t,v),i(v,F),i(v,M),i(v,E)},p(n,[u]){u&1&&c!==(c=n[0].playerOneState.score+"")&&j(f,c),u&1&&o!==(o=Math.round(n[0].globals.roundFrameCount/60)+"")&&j(R,o),u&1&&_!==(_=n[0].playerTwoState.score+"")&&j(O,_)},i:z,o:z,d(n){n&&l(t)}}}let le=0;function Ke(e,t,s){let{gameState:r}=t;return e.$$set=a=>{"gameState"in a&&s(0,r=a.gameState)},[r]}class Be extends Q{constructor(t){super(),X(this,t,Ke,ze,J,{gameState:0})}}function Ne(e){let t,s,r,a,c,f,p,h,o,R,w,y,D,_,O="<h2>Instructions:</h2> <ul><li>A, RightArrow: Block (good timing = parry = point for the defender)</li> <li>Tap D or LeftArrow: Feint</li> <li>Hold D or LeftArrow: Attack</li></ul>",H,v,F,M,E;return r=new Be({props:{gameState:e[0]}}),p=new ae({props:{playerState:e[0].playerOneState}}),o=new ae({props:{playerState:e[0].playerTwoState}}),w=new Pe({}),{c(){t=k("div"),s=k("div"),N(r.$$.fragment),a=A(),c=k("div"),f=k("div"),N(p.$$.fragment),h=A(),N(o.$$.fragment),R=A(),N(w.$$.fragment),y=A(),D=A(),_=k("div"),_.innerHTML=O,H=A(),v=k("meta"),this.h()},l(n){t=b(n,"DIV",{role:!0,class:!0});var u=m(t);s=b(u,"DIV",{class:!0});var g=m(s);G(r.$$.fragment,g),g.forEach(l),a=T(u),c=b(u,"DIV",{class:!0});var $=m(c);f=b($,"DIV",{class:!0});var C=m(f);G(p.$$.fragment,C),h=T(C),G(o.$$.fragment,C),C.forEach(l),R=T($),G(w.$$.fragment,$),$.forEach(l),u.forEach(l),y=T(n),D=T(n),_=b(n,"DIV",{class:!0,"data-svelte-h":!0}),ke(_)!=="svelte-3lw9we"&&(_.innerHTML=O),H=T(n);const x=be("svelte-5bpqvt",document.head);v=b(x,"META",{name:!0,content:!0}),x.forEach(l),this.h()},h(){d(s,"class","flex items-center"),d(f,"class","grid grid-cols-2"),d(c,"class","relative m-4"),d(t,"role","application"),d(t,"class","container mx-auto border"),d(_,"class","px-[5vw]"),document.title="Redux Fighting Game",d(v,"name","description"),d(v,"content","The world's simplest fighting game.")},m(n,u){L(n,t,u),i(t,s),W(r,s,null),i(t,a),i(t,c),i(c,f),W(p,f,null),i(f,h),W(o,f,null),i(c,R),W(w,c,null),L(n,y,u),L(n,D,u),L(n,_,u),L(n,H,u),i(document.head,v),F=!0,M||(E=[ee(window,"keydown",e[1]),ee(window,"keyup",e[2])],M=!0)},p(n,[u]){const g={};u&1&&(g.gameState=n[0]),r.$set(g);const $={};u&1&&($.playerState=n[0].playerOneState),p.$set($);const C={};u&1&&(C.playerState=n[0].playerTwoState),o.$set(C)},i(n){F||(U(r.$$.fragment,n),U(p.$$.fragment,n),U(o.$$.fragment,n),U(w.$$.fragment,n),F=!0)},o(n){Y(r.$$.fragment,n),Y(p.$$.fragment,n),Y(o.$$.fragment,n),Y(w.$$.fragment,n),F=!1},d(n){n&&(l(t),l(y),l(D),l(_),l(H)),q(r),q(p),q(o),q(w),l(v),M=!1,de(E)}}}function Ge(e,t,s){let r;return oe(e,Z,f=>s(0,r=f)),setInterval(()=>{fe(Z,r=He(r),r)},1e3/60),he(()=>S(r)),[r,f=>$e(r,f),f=>Ae(r,f)]}class qe extends Q{constructor(t){super(),X(this,t,Ge,Ne,J,{})}}export{qe as component};

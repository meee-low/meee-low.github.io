import{s as re,n as x,c as te,o as ke,r as _e,B as Fe}from"../chunks/scheduler.cozbhhrJ.js";import{S as le,i as ne,e as p,c as b,a as y,d as c,l as f,g as O,t as M,b as H,h as s,j as ee,s as C,f as L,y as q,m as oe,E as z,A as B,F as Ae,r as Q,u as X,G as $e,v as Z,p as G,o as Ee,n as W,w as S,k as me,x as De}from"../chunks/index.vrwGYu6Y.js";import{w as ve}from"../chunks/index.B69iubOM.js";import{p as ye}from"../chunks/stores.DBm0h2P7.js";const ge=3,Te=10,Pe=14,Ce=100/Pe,Le=ge/10,Ie=3;let ae=ve({playerOneState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},playerTwoState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},globals:{roundCount:0,roundFrameCount:0,frozenFramesLeft:0,frozenReason:"",paused:!0}}),Y=ve({Player1Def:"a",Player1Atk:"d",Player2Atk:"ArrowLeft",Player2Def:"ArrowRight",Pause:"p"});function Re(e){if(e.playerOneState.attackCharge<100&&e.playerTwoState.attackCharge<100)return e;if(e.playerOneState.attackCharge>=100&&e.playerTwoState.attackCharge>=100)return e;let t=e.playerOneState.attackCharge>e.playerTwoState.attackCharge?1:2;return e=Oe(e,t),e}function ie(e,t){if(t===1)return e.playerOneState;if(t===2)return e.playerTwoState;throw new Error("Invalid player id. Only 2 people play this game.")}function Oe(e,t){let l=ie(e,t),r=ie(e,t%2+1);return r.parryFrames>0?(r.score+=1,e=se(e)):r.status==="blocking"&&r.blockStamina>=0?r.blockStamina=Math.max(0,r.blockStamina-Te):r.status==="neutral"&&(l.score+=1,e=se(e)),l.attackCharge=0,e}function Me(e){return e.keysHeld.has("def")&&e.keysHeld.has("atk")||!e.keysHeld.has("def")&&!e.keysHeld.has("atk")?(e.status="neutral",e.attackCharge=0):e.keysHeld.has("atk")?e.status="attacking":e.keysHeld.has("def")&&(e.attackCharge=0,e.status!=="blocking"&&(e.parryFrames=Ie),e.blockStamina>0&&e.blockForbiddenFramesLeft===0?e.status="blocking":e.status="neutral"),e}function we(e,t,l){return Y.subscribe(r=>{for(const[n,a]of Object.entries(r))t.key==a&&(t.preventDefault(),e=l(e,n))})(),e}function He(e,t){return we(e,t,Ve)}function Ne(e,t){return we(e,t,xe)}function Ve(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.add("def");break;case"Player1Atk":e.playerOneState.keysHeld.add("atk");break;case"Player2Def":e.playerTwoState.keysHeld.add("def");break;case"Player2Atk":e.playerTwoState.keysHeld.add("atk");break;case"Pause":e.globals.paused=!e.globals.paused;break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function xe(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.delete("def");break;case"Player1Atk":e.playerOneState.keysHeld.delete("atk");break;case"Player2Def":e.playerTwoState.keysHeld.delete("def");break;case"Player2Atk":e.playerTwoState.keysHeld.delete("atk");break;case"Pause":break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function ze(e){return e.status==="attacking"&&(e.attackCharge=Math.min(100,e.attackCharge+Ce)),e}function Be(e){return e.status==="blocking"&&(e.blockStamina=Math.max(0,e.blockStamina-ge),e.blockStamina===0&&(e.blockForbiddenFramesLeft=2*Pe-1)),e}function Ke(e){return(e.keysHeld.has("atk")||!e.keysHeld.has("def"))&&(e.blockStamina=Math.min(100,e.blockStamina+Le)),e}function Ue(e){return e={...e,parryFrames:Math.max(0,e.parryFrames-1),blockForbiddenFramesLeft:Math.max(0,e.blockForbiddenFramesLeft-1),attackForbiddenFramesLeft:Math.max(0,e.attackForbiddenFramesLeft-1)},e}function ue(e){return e={...e,status:"neutral",attackCharge:0,blockStamina:100,parryFrames:0},e}function se(e){return e={playerOneState:ue(e.playerOneState),playerTwoState:ue(e.playerTwoState),globals:{...e.globals,roundCount:e.globals.roundCount+1,roundFrameCount:0,frozenFramesLeft:60*3,frozenReason:"roundReset"}},e}function J(e,t){return e={...e,playerOneState:t(e.playerOneState),playerTwoState:t(e.playerTwoState)},e}function Ge(e){return e.globals.paused?e:e.globals.frozenFramesLeft>0?(--e.globals.frozenFramesLeft,e):(e.globals.frozenFramesLeft===0&&(e.globals.frozenReason=""),e=J(e,Me),e=J(e,Ke),e=J(e,ze),e=J(e,Be),e=J(e,Ue),e.globals.roundFrameCount+=1,e=Re(e),e)}function ce(e){let t,l;return{c(){t=p("p"),l=M(e[0]),this.h()},l(r){t=b(r,"P",{class:!0});var n=y(t);l=H(n,e[0]),n.forEach(c),this.h()},h(){f(t,"class","m-auto text-4xl")},m(r,n){O(r,t,n),s(t,l)},p(r,n){n&1&&ee(l,r[0])},d(r){r&&c(t)}}}function We(e){let t,l=e[0]&&ce(e);return{c(){t=p("div"),l&&l.c(),this.h()},l(r){t=b(r,"DIV",{class:!0});var n=y(t);l&&l.l(n),n.forEach(c),this.h()},h(){f(t,"class","absolute inset-0 flex h-full w-full items-center justify-center")},m(r,n){O(r,t,n),l&&l.m(t,null)},p(r,[n]){r[0]?l?l.p(r,n):(l=ce(r),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i:x,o:x,d(r){r&&c(t),l&&l.d()}}}function je(e){return e.globals.paused?"(P)aused.":e.globals.frozenFramesLeft>0&&e.globals.frozenReason==="roundReset"?e.globals.frozenFramesLeft<=1?"Go!":""+Math.max(1,Math.round(e.globals.frozenFramesLeft/60)):null}function Ye(e,t,l){let r,n;return te(e,ae,a=>l(1,n=a)),e.$$.update=()=>{e.$$.dirty&2&&l(0,r=je(n))},[r,n]}class qe extends le{constructor(t){super(),ne(this,t,Ye,We,re,{})}}function Je(e){let t,l,r,n,a,d,h;return{c(){t=p("div"),l=p("div"),n=C(),a=p("div"),this.h()},l(i){t=b(i,"DIV",{class:!0});var o=y(t);l=b(o,"DIV",{class:!0,style:!0}),y(l).forEach(c),n=L(o),a=b(o,"DIV",{class:!0,style:!0}),y(a).forEach(c),o.forEach(c),this.h()},h(){f(l,"class",r=(e[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800"),q(l,"height",e[0].blockStamina+"%"),f(a,"class",d=(e[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800"),q(a,"height",e[0].attackCharge+"%"),f(t,"class",h=fe(e[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")},m(i,o){O(i,t,o),s(t,l),s(t,n),s(t,a)},p(i,[o]){o&1&&r!==(r=(i[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800")&&f(l,"class",r),o&1&&q(l,"height",i[0].blockStamina+"%"),o&1&&d!==(d=(i[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800")&&f(a,"class",d),o&1&&q(a,"height",i[0].attackCharge+"%"),o&1&&h!==(h=fe(i[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")&&f(t,"class",h)},i:x,o:x,d(i){i&&c(t)}}}function fe(e){return e==="blocking"||e==="blocking-start"?"bg-red-500":e==="attacking"?"bg-sky-500":"bg-yellow-400"}function Qe(e,t,l){let{playerState:r}=t;return e.$$set=n=>{"playerState"in n&&l(0,r=n.playerState)},[r]}class de extends le{constructor(t){super(),ne(this,t,Qe,Je,re,{playerState:0})}}function Xe(e){let t,l,r,n,a=e[0].playerOneState.score+"",d,h,i,o=Math.round(e[0].globals.roundFrameCount/60)+"",$,m,g,I,v=e[0].playerTwoState.score+"",F,A,E,R,P,_;return{c(){t=p("div"),l=p("div"),r=p("p"),n=M("W:"),d=M(a),h=C(),i=p("p"),$=M(o),m=C(),g=p("p"),I=M("W:"),F=M(v),A=C(),E=p("div"),R=p("div"),P=C(),_=p("div"),this.h()},l(k){t=b(k,"DIV",{class:!0});var T=y(t);l=b(T,"DIV",{id:!0,class:!0});var D=y(l);r=b(D,"P",{class:!0});var N=y(r);n=H(N,"W:"),d=H(N,a),N.forEach(c),h=L(D),i=b(D,"P",{class:!0});var u=y(i);$=H(u,o),u.forEach(c),m=L(D),g=b(D,"P",{class:!0});var w=y(g);I=H(w,"W:"),F=H(w,v),w.forEach(c),D.forEach(c),A=L(T),E=b(T,"DIV",{class:!0});var V=y(E);R=b(V,"DIV",{class:!0,style:!0}),y(R).forEach(c),P=L(V),_=b(V,"DIV",{class:!0,style:!0}),y(_).forEach(c),V.forEach(c),T.forEach(c),this.h()},h(){f(r,"class","text-center"),f(i,"class","text-center"),f(g,"class","text-center"),f(l,"id","bar"),f(l,"class","grid w-full grid-cols-3"),f(R,"class","absolute h-10 w-6 bg-blue-500"),q(R,"left","calc("+he/6*100+"% - 12px)"),f(_,"class","absolute h-10 w-6 bg-orange-500"),q(_,"right","calc("+he/6*100+"% - 12px)"),f(E,"class","relative mx-8"),f(t,"class","min-h-20 w-full bg-gray-500 p-2")},m(k,T){O(k,t,T),s(t,l),s(l,r),s(r,n),s(r,d),s(l,h),s(l,i),s(i,$),s(l,m),s(l,g),s(g,I),s(g,F),s(t,A),s(t,E),s(E,R),s(E,P),s(E,_)},p(k,[T]){T&1&&a!==(a=k[0].playerOneState.score+"")&&ee(d,a),T&1&&o!==(o=Math.round(k[0].globals.roundFrameCount/60)+"")&&ee($,o),T&1&&v!==(v=k[0].playerTwoState.score+"")&&ee(F,v)},i:x,o:x,d(k){k&&c(t)}}}let he=0;function Ze(e,t,l){let{gameState:r}=t;return e.$$set=n=>{"gameState"in n&&l(0,r=n.gameState)},[r]}class Se extends le{constructor(t){super(),ne(this,t,Ze,Xe,re,{gameState:0})}}function pe(e){let t,l,r,n,a,d,h,i,o,$,m,g,I,v,F,A,E,R;return{c(){t=p("form"),l=p("label"),r=M(`P1 Attack:\r
      `),n=p("input"),a=C(),d=p("label"),h=M(`P1 Defend:\r
      `),i=p("input"),o=C(),$=p("label"),m=M(`P2 Attack:\r
      `),g=p("input"),I=C(),v=p("label"),F=M(`P2 Defend:\r
      `),A=p("input"),this.h()},l(P){t=b(P,"FORM",{class:!0});var _=y(t);l=b(_,"LABEL",{});var k=y(l);r=H(k,`P1 Attack:\r
      `),n=b(k,"INPUT",{type:!0,class:!0}),k.forEach(c),a=L(_),d=b(_,"LABEL",{});var T=y(d);h=H(T,`P1 Defend:\r
      `),i=b(T,"INPUT",{type:!0,class:!0}),T.forEach(c),o=L(_),$=b(_,"LABEL",{});var D=y($);m=H(D,`P2 Attack:\r
      `),g=b(D,"INPUT",{type:!0,class:!0}),D.forEach(c),I=L(_),v=b(_,"LABEL",{});var N=y(v);F=H(N,`P2 Defend:\r
      `),A=b(N,"INPUT",{type:!0,class:!0}),N.forEach(c),_.forEach(c),this.h()},h(){f(n,"type","text"),f(n,"class","border"),f(i,"type","text"),f(i,"class","border"),f(g,"type","text"),f(g,"class","min-w-0 border"),f(A,"type","text"),f(A,"class","border"),f(t,"class","flex flex-col")},m(P,_){O(P,t,_),s(t,l),s(l,r),s(l,n),z(n,e[1].Player1Atk),s(t,a),s(t,d),s(d,h),s(d,i),z(i,e[1].Player1Def),s(t,o),s(t,$),s($,m),s($,g),z(g,e[1].Player2Atk),s(t,I),s(t,v),s(v,F),s(v,A),z(A,e[1].Player2Def),E||(R=[B(n,"input",e[2]),B(i,"input",e[3]),B(g,"input",e[4]),B(A,"input",e[5]),B(t,"submit",Ae(tt))],E=!0)},p(P,_){_&2&&n.value!==P[1].Player1Atk&&z(n,P[1].Player1Atk),_&2&&i.value!==P[1].Player1Def&&z(i,P[1].Player1Def),_&2&&g.value!==P[1].Player2Atk&&z(g,P[1].Player2Atk),_&2&&A.value!==P[1].Player2Def&&z(A,P[1].Player2Def)},d(P){P&&c(t),E=!1,_e(R)}}}function et(e){let t=e[0].url.searchParams.has("rebind"),l,r=t&&pe(e);return{c(){r&&r.c(),l=oe()},l(n){r&&r.l(n),l=oe()},m(n,a){r&&r.m(n,a),O(n,l,a)},p(n,[a]){a&1&&(t=n[0].url.searchParams.has("rebind")),t?r?r.p(n,a):(r=pe(n),r.c(),r.m(l.parentNode,l)):r&&(r.d(1),r=null)},i:x,o:x,d(n){n&&c(l),r&&r.d(n)}}}function tt(){}function rt(e,t,l){let r,n;te(e,ye,o=>l(0,r=o)),te(e,Y,o=>l(1,n=o)),ke(()=>{console.log(r.url.searchParams)});function a(){n.Player1Atk=this.value,Y.set(n)}function d(){n.Player1Def=this.value,Y.set(n)}function h(){n.Player2Atk=this.value,Y.set(n)}function i(){n.Player2Def=this.value,Y.set(n)}return[r,n,a,d,h,i]}class lt extends le{constructor(t){super(),ne(this,t,rt,et,re,{})}}function be(e){let t,l,r="Debug:",n,a,d=JSON.stringify(e[3])+"",h;return{c(){t=p("div"),l=p("h2"),l.textContent=r,n=C(),a=p("p"),h=M(d),this.h()},l(i){t=b(i,"DIV",{id:!0});var o=y(t);l=b(o,"H2",{class:!0,"data-svelte-h":!0}),me(l)!=="svelte-8uuk3j"&&(l.textContent=r),n=L(o),a=b(o,"P",{});var $=y(a);h=H($,d),$.forEach(c),o.forEach(c),this.h()},h(){f(l,"class","max-w-[100vw]"),f(t,"id","debug")},m(i,o){O(i,t,o),s(t,l),s(t,n),s(t,a),s(a,h)},p(i,o){o&8&&d!==(d=JSON.stringify(i[3])+"")&&ee(h,d)},d(i){i&&c(t)}}}function nt(e){let t,l="<h2>Instructions:</h2> <ul><li>A, RightArrow: Block (good timing = parry = point for the defender)</li> <li>Tap D or LeftArrow: Feint</li> <li>Hold D or LeftArrow: Attack</li></ul>";return{c(){t=p("div"),t.innerHTML=l,this.h()},l(r){t=b(r,"DIV",{class:!0,"data-svelte-h":!0}),me(t)!=="svelte-c2rn86"&&(t.innerHTML=l),this.h()},h(){f(t,"class","px-[5vw]")},m(r,n){O(r,t,n)},i:x,o:x,d(r){r&&c(t)}}}function at(e){let t,l;return t=new lt({}),{c(){Q(t.$$.fragment)},l(r){X(t.$$.fragment,r)},m(r,n){Z(t,r,n),l=!0},i(r){l||(W(t.$$.fragment,r),l=!0)},o(r){G(t.$$.fragment,r),l=!1},d(r){S(t,r)}}}function st(e){let t,l,r,n,a,d,h,i,o,$,m,g,I,v,F,A,E,R,P,_;r=new Se({props:{gameState:e[3]}}),h=new de({props:{playerState:e[3].playerOneState}}),o=new de({props:{playerState:e[3].playerTwoState}}),m=new qe({});let k=e[1]&&be(e);const T=[at,nt],D=[];function N(u,w){return u[2]?0:1}return v=N(e),F=D[v]=T[v](e),{c(){t=p("div"),l=p("div"),Q(r.$$.fragment),n=C(),a=p("div"),d=p("div"),Q(h.$$.fragment),i=C(),Q(o.$$.fragment),$=C(),Q(m.$$.fragment),g=C(),k&&k.c(),I=C(),F.c(),A=C(),E=p("meta"),this.h()},l(u){t=b(u,"DIV",{role:!0,class:!0,tabindex:!0});var w=y(t);l=b(w,"DIV",{class:!0});var V=y(l);X(r.$$.fragment,V),V.forEach(c),n=L(w),a=b(w,"DIV",{class:!0});var K=y(a);d=b(K,"DIV",{class:!0});var U=y(d);X(h.$$.fragment,U),i=L(U),X(o.$$.fragment,U),U.forEach(c),$=L(K),X(m.$$.fragment,K),K.forEach(c),w.forEach(c),g=L(u),k&&k.l(u),I=L(u),F.l(u),A=L(u);const j=$e("svelte-5bpqvt",document.head);E=b(j,"META",{name:!0,content:!0}),j.forEach(c),this.h()},h(){f(l,"class","flex items-center"),f(d,"class","grid grid-cols-2"),f(a,"class","relative m-4"),f(t,"role","application"),f(t,"class","container mx-auto select-none border"),f(t,"tabindex","0"),document.title="Redux Fighting Game",f(E,"name","description"),f(E,"content","The world's simplest fighting game.")},m(u,w){O(u,t,w),s(t,l),Z(r,l,null),s(t,n),s(t,a),s(a,d),Z(h,d,null),s(d,i),Z(o,d,null),s(a,$),Z(m,a,null),O(u,g,w),k&&k.m(u,w),O(u,I,w),D[v].m(u,w),O(u,A,w),s(document.head,E),R=!0,P||(_=[B(t,"focus",e[4]),B(t,"keydown",e[5]),B(t,"keyup",e[6])],P=!0)},p(u,[w]){const V={};w&8&&(V.gameState=u[3]),r.$set(V);const K={};w&8&&(K.playerState=u[3].playerOneState),h.$set(K);const U={};w&8&&(U.playerState=u[3].playerTwoState),o.$set(U),u[1]?k?k.p(u,w):(k=be(u),k.c(),k.m(I.parentNode,I)):k&&(k.d(1),k=null);let j=v;v=N(u),v!==j&&(De(),G(D[j],1,1,()=>{D[j]=null}),Ee(),F=D[v],F||(F=D[v]=T[v](u),F.c()),W(F,1),F.m(A.parentNode,A))},i(u){R||(W(r.$$.fragment,u),W(h.$$.fragment,u),W(o.$$.fragment,u),W(m.$$.fragment,u),W(F),R=!0)},o(u){G(r.$$.fragment,u),G(h.$$.fragment,u),G(o.$$.fragment,u),G(m.$$.fragment,u),G(F),R=!1},d(u){u&&(c(t),c(g),c(I),c(A)),S(r),S(h),S(o),S(m),k&&k.d(u),D[v].d(u),c(E),P=!1,_e(_)}}}function ot(e,t,l){let r,n;te(e,ye,m=>l(7,r=m)),te(e,ae,m=>l(3,n=m));let a=!0,d=!1,h=!1;return setInterval(()=>{Fe(ae,n=Ge(n),n)},1e3/60),ke(()=>{se(n),l(1,d=r.url.searchParams.has("debug")),l(2,h=r.url.searchParams.has("rebind"))}),[a,d,h,n,m=>l(0,a=!0),m=>{a&&He(n,m)},m=>{a&&Ne(n,m)}]}class dt extends le{constructor(t){super(),ne(this,t,ot,st,re,{})}}export{dt as component};

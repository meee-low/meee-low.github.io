import{s as ee,n as I,c as S,o as ge,r as ye,B as we}from"../chunks/scheduler.cozbhhrJ.js";import{S as te,i as re,e as k,c as _,a as g,d as f,l as h,g as T,t as H,b as x,h as d,j as Y,s as C,f as P,y as j,m as oe,A as G,E as ne,q as Te,F as ie,r as J,u as Q,G as Re,v as X,p as K,o as De,n as B,w as Z,k as Fe,x as Le}from"../chunks/index.B5TGw0-G.js";import{w as $e}from"../chunks/index.B69iubOM.js";import{e as ue}from"../chunks/each.BCt865gT.js";import{p as Ee}from"../chunks/stores.D7phu61n.js";const Ae=3,Oe=10,Ce=14,Ie=100/Ce,Me=Ae/10,He=3;let se=$e({playerOneState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},playerTwoState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},globals:{roundCount:0,roundFrameCount:0,frozenFramesLeft:0,frozenReason:"",paused:!0}}),le=$e({Player1Def:"a",Player1Atk:"d",Player2Atk:"ArrowLeft",Player2Def:"ArrowRight",Pause:"p"});function xe(e){if(e.playerOneState.attackCharge<100&&e.playerTwoState.attackCharge<100)return e;if(e.playerOneState.attackCharge>=100&&e.playerTwoState.attackCharge>=100)return e;let t=e.playerOneState.attackCharge>e.playerTwoState.attackCharge?1:2;return e=Ve(e,t),e}function ce(e,t){if(t===1)return e.playerOneState;if(t===2)return e.playerTwoState;throw new Error("Invalid player id. Only 2 people play this game.")}function Ve(e,t){let n=ce(e,t),r=ce(e,t%2+1);return r.parryFrames>0?(r.score+=1,e=ae(e)):r.status==="blocking"&&r.blockStamina>=0?r.blockStamina=Math.max(0,r.blockStamina-Oe):r.status==="neutral"&&(n.score+=1,e=ae(e)),n.attackCharge=0,e}function Ne(e){return e.keysHeld.has("def")&&e.keysHeld.has("atk")||!e.keysHeld.has("def")&&!e.keysHeld.has("atk")?(e.status="neutral",e.attackCharge=0):e.keysHeld.has("atk")?e.status="attacking":e.keysHeld.has("def")&&(e.attackCharge=0,e.status!=="blocking"&&(e.parryFrames=He),e.blockStamina>0&&e.blockForbiddenFramesLeft===0?e.status="blocking":e.status="neutral"),e}function Pe(e,t,n){return le.subscribe(r=>{for(const[s,l]of Object.entries(r))t.key==l&&(t.preventDefault(),e=n(e,s))})(),e}function ze(e,t){return Pe(e,t,Be)}function Ke(e,t){return Pe(e,t,Ge)}function Be(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.add("def");break;case"Player1Atk":e.playerOneState.keysHeld.add("atk");break;case"Player2Def":e.playerTwoState.keysHeld.add("def");break;case"Player2Atk":e.playerTwoState.keysHeld.add("atk");break;case"Pause":e.globals.paused=!e.globals.paused;break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function Ge(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.delete("def");break;case"Player1Atk":e.playerOneState.keysHeld.delete("atk");break;case"Player2Def":e.playerTwoState.keysHeld.delete("def");break;case"Player2Atk":e.playerTwoState.keysHeld.delete("atk");break;case"Pause":break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function Ue(e){return e.status==="attacking"&&(e.attackCharge=Math.min(100,e.attackCharge+Ie)),e}function We(e){return e.status==="blocking"&&(e.blockStamina=Math.max(0,e.blockStamina-Ae),e.blockStamina===0&&(e.blockForbiddenFramesLeft=2*Ce-1)),e}function je(e){return(e.keysHeld.has("atk")||!e.keysHeld.has("def"))&&(e.blockStamina=Math.min(100,e.blockStamina+Me)),e}function Ye(e){return e={...e,parryFrames:Math.max(0,e.parryFrames-1),blockForbiddenFramesLeft:Math.max(0,e.blockForbiddenFramesLeft-1),attackForbiddenFramesLeft:Math.max(0,e.attackForbiddenFramesLeft-1)},e}function fe(e){return e={...e,status:"neutral",attackCharge:0,blockStamina:100,parryFrames:0},e}function ae(e){return e={playerOneState:fe(e.playerOneState),playerTwoState:fe(e.playerTwoState),globals:{...e.globals,roundCount:e.globals.roundCount+1,roundFrameCount:0,frozenFramesLeft:60*3,frozenReason:"roundReset"}},e}function q(e,t){return e={...e,playerOneState:t(e.playerOneState),playerTwoState:t(e.playerTwoState)},e}function qe(e){return e.globals.paused?e:e.globals.frozenFramesLeft>0?(--e.globals.frozenFramesLeft,e):(e.globals.frozenFramesLeft===0&&(e.globals.frozenReason=""),e=q(e,Ne),e=q(e,je),e=q(e,Ue),e=q(e,We),e=q(e,Ye),e.globals.roundFrameCount+=1,e=xe(e),e)}function de(e){let t,n;return{c(){t=k("p"),n=H(e[0]),this.h()},l(r){t=_(r,"P",{class:!0});var s=g(t);n=x(s,e[0]),s.forEach(f),this.h()},h(){h(t,"class","m-auto text-4xl")},m(r,s){T(r,t,s),d(t,n)},p(r,s){s&1&&Y(n,r[0])},d(r){r&&f(t)}}}function Je(e){let t,n=e[0]&&de(e);return{c(){t=k("div"),n&&n.c(),this.h()},l(r){t=_(r,"DIV",{class:!0});var s=g(t);n&&n.l(s),s.forEach(f),this.h()},h(){h(t,"class","absolute inset-0 flex h-full w-full items-center justify-center")},m(r,s){T(r,t,s),n&&n.m(t,null)},p(r,[s]){r[0]?n?n.p(r,s):(n=de(r),n.c(),n.m(t,null)):n&&(n.d(1),n=null)},i:I,o:I,d(r){r&&f(t),n&&n.d()}}}function Qe(e){return e.globals.paused?"(P)aused.":e.globals.frozenFramesLeft>0&&e.globals.frozenReason==="roundReset"?e.globals.frozenFramesLeft<=1?"Go!":""+Math.max(1,Math.round(e.globals.frozenFramesLeft/60)):null}function Xe(e,t,n){let r,s;return S(e,se,l=>n(1,s=l)),e.$$.update=()=>{e.$$.dirty&2&&n(0,r=Qe(s))},[r,s]}class Ze extends te{constructor(t){super(),re(this,t,Xe,Je,ee,{})}}function Se(e){let t,n,r,s,l,o,i;return{c(){t=k("div"),n=k("div"),s=C(),l=k("div"),this.h()},l(a){t=_(a,"DIV",{class:!0});var u=g(t);n=_(u,"DIV",{class:!0,style:!0}),g(n).forEach(f),s=P(u),l=_(u,"DIV",{class:!0,style:!0}),g(l).forEach(f),u.forEach(f),this.h()},h(){h(n,"class",r=(e[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800"),j(n,"height",e[0].blockStamina+"%"),h(l,"class",o=(e[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800"),j(l,"height",e[0].attackCharge+"%"),h(t,"class",i=he(e[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")},m(a,u){T(a,t,u),d(t,n),d(t,s),d(t,l)},p(a,[u]){u&1&&r!==(r=(a[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800")&&h(n,"class",r),u&1&&j(n,"height",a[0].blockStamina+"%"),u&1&&o!==(o=(a[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800")&&h(l,"class",o),u&1&&j(l,"height",a[0].attackCharge+"%"),u&1&&i!==(i=he(a[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")&&h(t,"class",i)},i:I,o:I,d(a){a&&f(t)}}}function he(e){return e==="blocking"||e==="blocking-start"?"bg-red-500":e==="attacking"?"bg-sky-500":"bg-yellow-400"}function et(e,t,n){let{playerState:r}=t;return e.$$set=s=>{"playerState"in s&&n(0,r=s.playerState)},[r]}class pe extends te{constructor(t){super(),re(this,t,et,Se,ee,{playerState:0})}}function tt(e){let t,n,r,s,l=e[0].playerOneState.score+"",o,i,a,u=Math.round(e[0].globals.roundFrameCount/60)+"",$,p,m,D,y=e[0].playerTwoState.score+"",w,L,F,R,V,M;return{c(){t=k("div"),n=k("div"),r=k("p"),s=H("W:"),o=H(l),i=C(),a=k("p"),$=H(u),p=C(),m=k("p"),D=H("W:"),w=H(y),L=C(),F=k("div"),R=k("div"),V=C(),M=k("div"),this.h()},l(b){t=_(b,"DIV",{class:!0});var A=g(t);n=_(A,"DIV",{id:!0,class:!0});var E=g(n);r=_(E,"P",{class:!0});var U=g(r);s=x(U,"W:"),o=x(U,l),U.forEach(f),i=P(E),a=_(E,"P",{class:!0});var c=g(a);$=x(c,u),c.forEach(f),p=P(E),m=_(E,"P",{class:!0});var v=g(m);D=x(v,"W:"),w=x(v,y),v.forEach(f),E.forEach(f),L=P(A),F=_(A,"DIV",{class:!0});var O=g(F);R=_(O,"DIV",{class:!0,style:!0}),g(R).forEach(f),V=P(O),M=_(O,"DIV",{class:!0,style:!0}),g(M).forEach(f),O.forEach(f),A.forEach(f),this.h()},h(){h(r,"class","text-center"),h(a,"class","text-center"),h(m,"class","text-center"),h(n,"id","bar"),h(n,"class","grid w-full grid-cols-3"),h(R,"class","absolute h-10 w-6 bg-blue-500"),j(R,"left","calc("+be/6*100+"% - 12px)"),h(M,"class","absolute h-10 w-6 bg-orange-500"),j(M,"right","calc("+be/6*100+"% - 12px)"),h(F,"class","relative mx-8"),h(t,"class","min-h-20 w-full bg-gray-500 p-2")},m(b,A){T(b,t,A),d(t,n),d(n,r),d(r,s),d(r,o),d(n,i),d(n,a),d(a,$),d(n,p),d(n,m),d(m,D),d(m,w),d(t,L),d(t,F),d(F,R),d(F,V),d(F,M)},p(b,[A]){A&1&&l!==(l=b[0].playerOneState.score+"")&&Y(o,l),A&1&&u!==(u=Math.round(b[0].globals.roundFrameCount/60)+"")&&Y($,u),A&1&&y!==(y=b[0].playerTwoState.score+"")&&Y(w,y)},i:I,o:I,d(b){b&&f(t)}}}let be=0;function rt(e,t,n){let{gameState:r}=t;return e.$$set=s=>{"gameState"in s&&n(0,r=s.gameState)},[r]}class nt extends te{constructor(t){super(),re(this,t,rt,tt,ee,{gameState:0})}}function ke(e,t,n){const r=e.slice();return r[4]=t[n][0],r[5]=t[n][1],r[6]=t,r[7]=n,r}function _e(e){let t,n,r,s=ue(Object.entries(e[1])),l=[];for(let o=0;o<s.length;o+=1)l[o]=me(ke(e,s,o));return{c(){t=k("form");for(let o=0;o<l.length;o+=1)l[o].c();this.h()},l(o){t=_(o,"FORM",{class:!0});var i=g(t);for(let a=0;a<l.length;a+=1)l[a].l(i);i.forEach(f),this.h()},h(){h(t,"class","flex flex-col")},m(o,i){T(o,t,i);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null);n||(r=G(t,"submit",ne(lt)),n=!0)},p(o,i){if(i&2){s=ue(Object.entries(o[1]));let a;for(a=0;a<s.length;a+=1){const u=ke(o,s,a);l[a]?l[a].p(u,i):(l[a]=me(u),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=s.length}},d(o){o&&f(t),Te(l,o),n=!1,r()}}}function me(e){let t,n=e[4]+"",r,s,l,o,i,a;function u(...p){return e[2](e[4],...p)}function $(){e[3].call(l,e[6],e[7])}return{c(){t=k("label"),r=H(n),s=H(`:\r
        `),l=k("input"),o=C(),this.h()},l(p){t=_(p,"LABEL",{});var m=g(t);r=x(m,n),s=x(m,`:\r
        `),l=_(m,"INPUT",{type:!0,class:!0}),o=P(m),m.forEach(f),this.h()},h(){h(l,"type","text"),h(l,"class","border")},m(p,m){T(p,t,m),d(t,r),d(t,s),d(t,l),ie(l,e[5]),d(t,o),i||(a=[G(l,"input",ne(at)),G(l,"keydown",ne(u)),G(l,"input",$)],i=!0)},p(p,m){e=p,m&2&&n!==(n=e[4]+"")&&Y(r,n),m&2&&l.value!==e[5]&&ie(l,e[5])},d(p){p&&f(t),i=!1,ye(a)}}}function st(e){let t=e[0].url.searchParams.has("rebind"),n,r=t&&_e(e);return{c(){r&&r.c(),n=oe()},l(s){r&&r.l(s),n=oe()},m(s,l){r&&r.m(s,l),T(s,n,l)},p(s,[l]){l&1&&(t=s[0].url.searchParams.has("rebind")),t?r?r.p(s,l):(r=_e(s),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:I,o:I,d(s){s&&f(n),r&&r.d(s)}}}function lt(){}const at=e=>{};function ot(e,t,n){let r,s;S(e,Ee,i=>n(0,r=i)),S(e,le,i=>n(1,s=i)),ge(()=>{console.log(r.url.searchParams)});const l=(i,a)=>{we(le,s[i]=a.key,s)};function o(i,a){i[a][1]=this.value}return[r,s,l,o]}class it extends te{constructor(t){super(),re(this,t,ot,st,ee,{})}}function ve(e){let t,n,r="Debug:",s,l,o=JSON.stringify(e[3])+"",i;return{c(){t=k("div"),n=k("h2"),n.textContent=r,s=C(),l=k("p"),i=H(o),this.h()},l(a){t=_(a,"DIV",{id:!0});var u=g(t);n=_(u,"H2",{class:!0,"data-svelte-h":!0}),Fe(n)!=="svelte-8uuk3j"&&(n.textContent=r),s=P(u),l=_(u,"P",{});var $=g(l);i=x($,o),$.forEach(f),u.forEach(f),this.h()},h(){h(n,"class","max-w-[100vw]"),h(t,"id","debug")},m(a,u){T(a,t,u),d(t,n),d(t,s),d(t,l),d(l,i)},p(a,u){u&8&&o!==(o=JSON.stringify(a[3])+"")&&Y(i,o)},d(a){a&&f(t)}}}function ut(e){let t,n="<h2>Instructions:</h2> <ul><li>A, RightArrow: Block (good timing = parry = point for the defender)</li> <li>Tap D or LeftArrow: Feint</li> <li>Hold D or LeftArrow: Attack</li></ul>";return{c(){t=k("div"),t.innerHTML=n,this.h()},l(r){t=_(r,"DIV",{class:!0,"data-svelte-h":!0}),Fe(t)!=="svelte-c2rn86"&&(t.innerHTML=n),this.h()},h(){h(t,"class","px-[5vw]")},m(r,s){T(r,t,s)},i:I,o:I,d(r){r&&f(t)}}}function ct(e){let t,n;return t=new it({}),{c(){J(t.$$.fragment)},l(r){Q(t.$$.fragment,r)},m(r,s){X(t,r,s),n=!0},i(r){n||(B(t.$$.fragment,r),n=!0)},o(r){K(t.$$.fragment,r),n=!1},d(r){Z(t,r)}}}function ft(e){let t,n,r,s,l,o,i,a,u,$,p,m,D,y,w,L,F,R,V,M;r=new nt({props:{gameState:e[3]}}),i=new pe({props:{playerState:e[3].playerOneState}}),u=new pe({props:{playerState:e[3].playerTwoState}}),p=new Ze({});let b=e[1]&&ve(e);const A=[ct,ut],E=[];function U(c,v){return c[2]?0:1}return y=U(e),w=E[y]=A[y](e),{c(){t=k("div"),n=k("div"),J(r.$$.fragment),s=C(),l=k("div"),o=k("div"),J(i.$$.fragment),a=C(),J(u.$$.fragment),$=C(),J(p.$$.fragment),m=C(),b&&b.c(),D=C(),w.c(),L=C(),F=k("meta"),this.h()},l(c){t=_(c,"DIV",{role:!0,class:!0,tabindex:!0});var v=g(t);n=_(v,"DIV",{class:!0});var O=g(n);Q(r.$$.fragment,O),O.forEach(f),s=P(v),l=_(v,"DIV",{class:!0});var N=g(l);o=_(N,"DIV",{class:!0});var z=g(o);Q(i.$$.fragment,z),a=P(z),Q(u.$$.fragment,z),z.forEach(f),$=P(N),Q(p.$$.fragment,N),N.forEach(f),v.forEach(f),m=P(c),b&&b.l(c),D=P(c),w.l(c),L=P(c);const W=Re("svelte-5bpqvt",document.head);F=_(W,"META",{name:!0,content:!0}),W.forEach(f),this.h()},h(){h(n,"class","flex items-center"),h(o,"class","grid grid-cols-2"),h(l,"class","relative m-4"),h(t,"role","application"),h(t,"class","container mx-auto select-none border"),h(t,"tabindex","0"),document.title="Redux Fighting Game",h(F,"name","description"),h(F,"content","The world's simplest fighting game.")},m(c,v){T(c,t,v),d(t,n),X(r,n,null),d(t,s),d(t,l),d(l,o),X(i,o,null),d(o,a),X(u,o,null),d(l,$),X(p,l,null),T(c,m,v),b&&b.m(c,v),T(c,D,v),E[y].m(c,v),T(c,L,v),d(document.head,F),R=!0,V||(M=[G(t,"focus",e[4]),G(t,"keydown",e[5]),G(t,"keyup",e[6])],V=!0)},p(c,[v]){const O={};v&8&&(O.gameState=c[3]),r.$set(O);const N={};v&8&&(N.playerState=c[3].playerOneState),i.$set(N);const z={};v&8&&(z.playerState=c[3].playerTwoState),u.$set(z),c[1]?b?b.p(c,v):(b=ve(c),b.c(),b.m(D.parentNode,D)):b&&(b.d(1),b=null);let W=y;y=U(c),y!==W&&(Le(),K(E[W],1,1,()=>{E[W]=null}),De(),w=E[y],w||(w=E[y]=A[y](c),w.c()),B(w,1),w.m(L.parentNode,L))},i(c){R||(B(r.$$.fragment,c),B(i.$$.fragment,c),B(u.$$.fragment,c),B(p.$$.fragment,c),B(w),R=!0)},o(c){K(r.$$.fragment,c),K(i.$$.fragment,c),K(u.$$.fragment,c),K(p.$$.fragment,c),K(w),R=!1},d(c){c&&(f(t),f(m),f(D),f(L)),Z(r),Z(i),Z(u),Z(p),b&&b.d(c),E[y].d(c),f(F),V=!1,ye(M)}}}function dt(e,t,n){let r,s;S(e,Ee,p=>n(7,r=p)),S(e,se,p=>n(3,s=p));let l=!0,o=!1,i=!1;return setInterval(()=>{we(se,s=qe(s),s)},1e3/60),ge(()=>{ae(s),n(1,o=r.url.searchParams.has("debug")),n(2,i=r.url.searchParams.has("rebind"))}),[l,o,i,s,p=>n(0,l=!0),p=>{l&&ze(s,p)},p=>{l&&Ke(s,p)}]}class mt extends te{constructor(t){super(),re(this,t,dt,ft,ee,{})}}export{mt as component};

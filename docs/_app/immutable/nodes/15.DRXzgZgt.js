import{s as te,n as H,c as ee,o as $e,r as Ee,u as ne,v as Re}from"../chunks/scheduler.iXXlly_q.js";import{S as re,i as le,e as k,c as m,a as g,d as p,n as b,g as C,t as O,b as R,h as f,j as B,s as $,f as E,x as Y,y as ue,w as G,D as ae,r as Pe,C as ce,l as J,m as Q,v as Le,o as X,q as K,z as Me,p as j,u as Z,k as Te,A as He}from"../chunks/index.CGXjPJL2.js";import{e as se}from"../chunks/each.Ci6CQDud.js";import{w as Ae}from"../chunks/index.QRNuZ4ZZ.js";import{p as Ce}from"../chunks/stores.CciraBmR.js";const De=3,xe=10,Ie=14,Ve=100/Ie,Ne=De/10,ze=3;let S=Ae({playerOneState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,readyToParry:!0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},playerTwoState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,readyToParry:!0,blockForbiddenFramesLeft:0,attackForbiddenFramesLeft:0,keysHeld:new Set},globals:{roundCount:0,roundFrameCount:0,frozenFramesLeft:0,frozenReason:"",paused:!0}}),oe=Ae({Player1Def:"a",Player1Atk:"d",Player2Atk:"ArrowLeft",Player2Def:"ArrowRight",Pause:"p"});function Ke(e){if(e.playerOneState.attackCharge<100&&e.playerTwoState.attackCharge<100)return e;if(e.playerOneState.attackCharge>=100&&e.playerTwoState.attackCharge>=100)return e;let t=e.playerOneState.attackCharge>e.playerTwoState.attackCharge?1:2;return e=je(e,t),e}function fe(e,t){if(t===1)return e.playerOneState;if(t===2)return e.playerTwoState;throw new Error("Invalid player id. Only 2 people play this game.")}function je(e,t){let l=fe(e,t),r=fe(e,t%2+1);return r.parryFrames>0?(r.score+=1,e=ie(e)):r.status==="blocking"&&r.blockStamina>=0?r.blockStamina=Math.max(0,r.blockStamina-xe):r.status==="neutral"&&(l.score+=1,e=ie(e)),l.attackCharge=0,e}function Be(e){return e.keysHeld.has("def")&&e.keysHeld.has("atk")||!e.keysHeld.has("def")&&!e.keysHeld.has("atk")?(e.status="neutral",e.readyToParry=!0,e.attackCharge=0):e.keysHeld.has("atk")?(e.status="attacking",e.readyToParry=!0):e.keysHeld.has("def")&&(e.attackCharge=0,e.readyToParry&&(e.parryFrames=ze),e.readyToParry=!1,e.blockStamina>0&&e.blockForbiddenFramesLeft===0?e.status="blocking":e.status="neutral"),e}function Oe(e,t,l){return oe.subscribe(r=>{for(const[s,n]of Object.entries(r))t.key==n&&(t.preventDefault(),e=l(e,s))})(),e}function Ge(e,t){return Oe(e,t,We)}function Ue(e,t){return Oe(e,t,Ye)}function We(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.add("def");break;case"Player1Atk":e.playerOneState.keysHeld.add("atk");break;case"Player2Def":e.playerTwoState.keysHeld.add("def");break;case"Player2Atk":e.playerTwoState.keysHeld.add("atk");break;case"Pause":e.globals.paused=!e.globals.paused;break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function Ye(e,t){switch(t){case"Player1Def":e.playerOneState.keysHeld.delete("def");break;case"Player1Atk":e.playerOneState.keysHeld.delete("atk");break;case"Player2Def":e.playerTwoState.keysHeld.delete("def");break;case"Player2Atk":e.playerTwoState.keysHeld.delete("atk");break;case"Pause":break;default:console.log(`Error: Unexpected action: ${t}`)}return e}function qe(e){return e.status==="attacking"&&(e.attackCharge=Math.min(100,e.attackCharge+Ve)),e}function Je(e){return e.status==="blocking"&&(e.blockStamina=Math.max(0,e.blockStamina-De),e.blockStamina===0&&(e.blockForbiddenFramesLeft=2*Ie-1)),e}function Qe(e){return(e.keysHeld.has("atk")||!e.keysHeld.has("def"))&&(e.blockStamina=Math.min(100,e.blockStamina+Ne)),e}function Xe(e){return e={...e,parryFrames:Math.max(0,e.parryFrames-1),blockForbiddenFramesLeft:Math.max(0,e.blockForbiddenFramesLeft-1),attackForbiddenFramesLeft:Math.max(0,e.attackForbiddenFramesLeft-1)},e}function de(e){return e={...e,status:"neutral",attackCharge:0,blockStamina:100,parryFrames:0},e}function ie(e){return e={playerOneState:de(e.playerOneState),playerTwoState:de(e.playerTwoState),globals:{...e.globals,roundCount:e.globals.roundCount+1,roundFrameCount:0,frozenFramesLeft:60*3,frozenReason:"roundReset"}},e}function q(e,t){return e={...e,playerOneState:t(e.playerOneState),playerTwoState:t(e.playerTwoState)},e}function Ze(e){return e.globals.paused?e:e.globals.frozenFramesLeft>0?(--e.globals.frozenFramesLeft,e):(e.globals.frozenFramesLeft===0&&(e.globals.frozenReason=""),e=q(e,Be),e=q(e,Qe),e=q(e,qe),e=q(e,Je),e=q(e,Xe),e.globals.roundFrameCount+=1,e=Ke(e),e)}function he(e){let t,l;return{c(){t=k("p"),l=O(e[0]),this.h()},l(r){t=m(r,"P",{class:!0});var s=g(t);l=R(s,e[0]),s.forEach(p),this.h()},h(){b(t,"class","m-auto text-4xl")},m(r,s){C(r,t,s),f(t,l)},p(r,s){s&1&&B(l,r[0])},d(r){r&&p(t)}}}function Se(e){let t,l=e[0]&&he(e);return{c(){t=k("div"),l&&l.c(),this.h()},l(r){t=m(r,"DIV",{class:!0});var s=g(t);l&&l.l(s),s.forEach(p),this.h()},h(){b(t,"class","absolute inset-0 flex h-full w-full items-center justify-center")},m(r,s){C(r,t,s),l&&l.m(t,null)},p(r,[s]){r[0]?l?l.p(r,s):(l=he(r),l.c(),l.m(t,null)):l&&(l.d(1),l=null)},i:H,o:H,d(r){r&&p(t),l&&l.d()}}}function et(e){return e.globals.paused?"(P)aused.":e.globals.frozenFramesLeft>0&&e.globals.frozenReason==="roundReset"?e.globals.frozenFramesLeft<=1?"Go!":""+Math.max(1,Math.round(e.globals.frozenFramesLeft/60)):null}function tt(e,t,l){let r,s;return ee(e,S,n=>l(1,s=n)),e.$$.update=()=>{e.$$.dirty&2&&l(0,r=et(s))},[r,s]}class rt extends re{constructor(t){super(),le(this,t,tt,Se,te,{})}}function lt(e){let t,l,r,s,n,u,o,a,_,d;return{c(){t=k("div"),l=k("div"),s=$(),n=k("div"),o=$(),a=k("i"),this.h()},l(i){t=m(i,"DIV",{class:!0});var c=g(t);l=m(c,"DIV",{class:!0,style:!0}),g(l).forEach(p),s=E(c),n=m(c,"DIV",{class:!0,style:!0}),g(n).forEach(p),o=E(c),a=m(c,"I",{class:!0}),g(a).forEach(p),c.forEach(p),this.h()},h(){b(l,"class",r=(e[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800"),Y(l,"height",e[0].blockStamina+"%"),b(n,"class",u=(e[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800"),Y(n,"height",e[0].attackCharge+"%"),b(a,"class",_=_e(e[0])+" absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transform text-6xl text-gray-300"),b(t,"class",d=pe(e[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")},m(i,c){C(i,t,c),f(t,l),f(t,s),f(t,n),f(t,o),f(t,a)},p(i,[c]){c&1&&r!==(r=(i[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800")&&b(l,"class",r),c&1&&Y(l,"height",i[0].blockStamina+"%"),c&1&&u!==(u=(i[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800")&&b(n,"class",u),c&1&&Y(n,"height",i[0].attackCharge+"%"),c&1&&_!==(_=_e(i[0])+" absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transform text-6xl text-gray-300")&&b(a,"class",_),c&1&&d!==(d=pe(i[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")&&b(t,"class",d)},i:H,o:H,d(i){i&&p(t)}}}function pe(e){return e==="blocking"||e==="blocking-start"?"bg-red-500":e==="attacking"?"bg-sky-500":"bg-yellow-400"}function _e(e){return e.parryFrames>0?"fa-solid fa-exclamation":e.status=="blocking"?e.blockStamina>0?"fa-solid fa-shield":"fa-solid fa-shield-halved":e.status=="attacking"?"fa-solid fa-bolt":"invisible"}function nt(e,t,l){let{playerState:r}=t;return e.$$set=s=>{"playerState"in s&&l(0,r=s.playerState)},[r]}class be extends re{constructor(t){super(),le(this,t,nt,lt,te,{playerState:0})}}function st(e){let t,l,r,s,n=e[0].playerOneState.score+"",u,o,a,_=Math.round(e[0].globals.roundFrameCount/60)+"",d,i,c,T,w=e[0].playerTwoState.score+"",F,L,P,I,V,x;return{c(){t=k("div"),l=k("div"),r=k("p"),s=O("W:"),u=O(n),o=$(),a=k("p"),d=O(_),i=$(),c=k("p"),T=O("W:"),F=O(w),L=$(),P=k("div"),I=k("div"),V=$(),x=k("div"),this.h()},l(v){t=m(v,"DIV",{class:!0});var D=g(t);l=m(D,"DIV",{id:!0,class:!0});var A=g(l);r=m(A,"P",{class:!0});var U=g(r);s=R(U,"W:"),u=R(U,n),U.forEach(p),o=E(A),a=m(A,"P",{class:!0});var h=g(a);d=R(h,_),h.forEach(p),i=E(A),c=m(A,"P",{class:!0});var y=g(c);T=R(y,"W:"),F=R(y,w),y.forEach(p),A.forEach(p),L=E(D),P=m(D,"DIV",{class:!0});var M=g(P);I=m(M,"DIV",{class:!0,style:!0}),g(I).forEach(p),V=E(M),x=m(M,"DIV",{class:!0,style:!0}),g(x).forEach(p),M.forEach(p),D.forEach(p),this.h()},h(){b(r,"class","text-center"),b(a,"class","text-center"),b(c,"class","text-center"),b(l,"id","bar"),b(l,"class","grid w-full grid-cols-3"),b(I,"class","absolute h-10 w-6 bg-blue-500"),Y(I,"left","calc("+ke/6*100+"% - 12px)"),b(x,"class","absolute h-10 w-6 bg-orange-500"),Y(x,"right","calc("+ke/6*100+"% - 12px)"),b(P,"class","relative mx-8"),b(t,"class","min-h-20 w-full bg-gray-500 p-2")},m(v,D){C(v,t,D),f(t,l),f(l,r),f(r,s),f(r,u),f(l,o),f(l,a),f(a,d),f(l,i),f(l,c),f(c,T),f(c,F),f(t,L),f(t,P),f(P,I),f(P,V),f(P,x)},p(v,[D]){D&1&&n!==(n=v[0].playerOneState.score+"")&&B(u,n),D&1&&_!==(_=Math.round(v[0].globals.roundFrameCount/60)+"")&&B(d,_),D&1&&w!==(w=v[0].playerTwoState.score+"")&&B(F,w)},i:H,o:H,d(v){v&&p(t)}}}let ke=0;function at(e,t,l){let{gameState:r}=t;return e.$$set=s=>{"gameState"in s&&l(0,r=s.gameState)},[r]}class ot extends re{constructor(t){super(),le(this,t,at,st,te,{gameState:0})}}function me(e,t,l){const r=e.slice();return r[4]=t[l][0],r[5]=t[l][1],r[6]=t,r[7]=l,r}function ve(e){let t,l,r,s=se(Object.entries(e[1])),n=[];for(let u=0;u<s.length;u+=1)n[u]=ge(me(e,s,u));return{c(){t=k("form");for(let u=0;u<n.length;u+=1)n[u].c();this.h()},l(u){t=m(u,"FORM",{class:!0});var o=g(t);for(let a=0;a<n.length;a+=1)n[a].l(o);o.forEach(p),this.h()},h(){b(t,"class","flex flex-col")},m(u,o){C(u,t,o);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(t,null);l||(r=G(t,"submit",ae(ut)),l=!0)},p(u,o){if(o&2){s=se(Object.entries(u[1]));let a;for(a=0;a<s.length;a+=1){const _=me(u,s,a);n[a]?n[a].p(_,o):(n[a]=ge(_),n[a].c(),n[a].m(t,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=s.length}},d(u){u&&p(t),Pe(n,u),l=!1,r()}}}function ge(e){let t,l=e[4]+"",r,s,n,u,o,a;function _(...i){return e[2](e[4],...i)}function d(){e[3].call(n,e[6],e[7])}return{c(){t=k("label"),r=O(l),s=O(`:
        `),n=k("input"),u=$(),this.h()},l(i){t=m(i,"LABEL",{});var c=g(t);r=R(c,l),s=R(c,`:
        `),n=m(c,"INPUT",{type:!0,class:!0}),u=E(c),c.forEach(p),this.h()},h(){b(n,"type","text"),b(n,"class","border")},m(i,c){C(i,t,c),f(t,r),f(t,s),f(t,n),ce(n,e[5]),f(t,u),o||(a=[G(n,"input",ae(ct)),G(n,"keydown",ae(_)),G(n,"input",d)],o=!0)},p(i,c){e=i,c&2&&l!==(l=e[4]+"")&&B(r,l),c&2&&n.value!==e[5]&&ce(n,e[5])},d(i){i&&p(t),o=!1,Ee(a)}}}function it(e){let t=e[0].url.searchParams.has("rebind"),l,r=t&&ve(e);return{c(){r&&r.c(),l=ue()},l(s){r&&r.l(s),l=ue()},m(s,n){r&&r.m(s,n),C(s,l,n)},p(s,[n]){n&1&&(t=s[0].url.searchParams.has("rebind")),t?r?r.p(s,n):(r=ve(s),r.c(),r.m(l.parentNode,l)):r&&(r.d(1),r=null)},i:H,o:H,d(s){s&&p(l),r&&r.d(s)}}}function ut(){}const ct=e=>{};function ft(e,t,l){let r,s;ee(e,Ce,o=>l(0,r=o)),ee(e,oe,o=>l(1,s=o)),$e(()=>{console.log(r.url.searchParams)});const n=(o,a)=>{ne(oe,s[o]=a.key,s)};function u(o,a){o[a][1]=this.value}return[r,s,n,u]}class dt extends re{constructor(t){super(),le(this,t,ft,it,te,{})}}function ye(e,t,l){const r=e.slice();return r[8]=t[l][0],r[9]=t[l][1],r}function we(e){let t,l,r="Debug:",s,n,u=se(Object.entries(e[3])),o=[];for(let a=0;a<u.length;a+=1)o[a]=Fe(ye(e,u,a));return{c(){t=k("div"),l=k("h2"),l.textContent=r,s=$(),n=k("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){t=m(a,"DIV",{id:!0,class:!0});var _=g(t);l=m(_,"H2",{class:!0,"data-svelte-h":!0}),Te(l)!=="svelte-8uuk3j"&&(l.textContent=r),s=E(_),n=m(_,"DIV",{class:!0});var d=g(n);for(let i=0;i<o.length;i+=1)o[i].l(d);d.forEach(p),_.forEach(p),this.h()},h(){b(l,"class","max-w-[100vw]"),b(n,"class","grid auto-cols-fr grid-flow-col"),b(t,"id","debug"),b(t,"class","mx-[5vw]")},m(a,_){C(a,t,_),f(t,l),f(t,s),f(t,n);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(n,null)},p(a,_){if(_&8){u=se(Object.entries(a[3]));let d;for(d=0;d<u.length;d+=1){const i=ye(a,u,d);o[d]?o[d].p(i,_):(o[d]=Fe(i),o[d].c(),o[d].m(n,null))}for(;d<o.length;d+=1)o[d].d(1);o.length=u.length}},d(a){a&&p(t),Pe(o,a)}}}function Fe(e){let t,l,r=e[8]+"",s,n,u,o,a=JSON.stringify(e[9],null,2)+"",_,d;return{c(){t=k("div"),l=k("h3"),s=O(r),n=O(":"),u=$(),o=k("p"),_=O(a),d=$(),this.h()},l(i){t=m(i,"DIV",{});var c=g(t);l=m(c,"H3",{});var T=g(l);s=R(T,r),n=R(T,":"),T.forEach(p),u=E(c),o=m(c,"P",{class:!0});var w=g(o);_=R(w,a),w.forEach(p),d=E(c),c.forEach(p),this.h()},h(){b(o,"class","whitespace-pre-wrap")},m(i,c){C(i,t,c),f(t,l),f(l,s),f(l,n),f(t,u),f(t,o),f(o,_),f(t,d)},p(i,c){c&8&&r!==(r=i[8]+"")&&B(s,r),c&8&&a!==(a=JSON.stringify(i[9],null,2)+"")&&B(_,a)},d(i){i&&p(t)}}}function ht(e){let t,l="<h2>Instructions:</h2> <ul><li>A, RightArrow: Block (good timing = parry = point for the defender)</li> <li>Tap D or LeftArrow: Feint</li> <li>Hold D or LeftArrow: Attack</li></ul>";return{c(){t=k("div"),t.innerHTML=l,this.h()},l(r){t=m(r,"DIV",{class:!0,"data-svelte-h":!0}),Te(t)!=="svelte-c2rn86"&&(t.innerHTML=l),this.h()},h(){b(t,"class","px-[5vw]")},m(r,s){C(r,t,s)},i:H,o:H,d(r){r&&p(t)}}}function pt(e){let t,l;return t=new dt({}),{c(){J(t.$$.fragment)},l(r){Q(t.$$.fragment,r)},m(r,s){X(t,r,s),l=!0},i(r){l||(j(t.$$.fragment,r),l=!0)},o(r){K(t.$$.fragment,r),l=!1},d(r){Z(t,r)}}}function _t(e){let t,l,r,s,n,u,o,a,_,d,i,c,T,w,F,L,P,I,V,x;r=new ot({props:{gameState:e[3]}}),o=new be({props:{playerState:e[3].playerOneState}}),_=new be({props:{playerState:e[3].playerTwoState}}),i=new rt({});let v=e[1]&&we(e);const D=[pt,ht],A=[];function U(h,y){return h[2]?0:1}return w=U(e),F=A[w]=D[w](e),{c(){t=k("div"),l=k("div"),J(r.$$.fragment),s=$(),n=k("div"),u=k("div"),J(o.$$.fragment),a=$(),J(_.$$.fragment),d=$(),J(i.$$.fragment),c=$(),v&&v.c(),T=$(),F.c(),L=$(),P=k("meta"),this.h()},l(h){t=m(h,"DIV",{role:!0,class:!0,tabindex:!0});var y=g(t);l=m(y,"DIV",{class:!0});var M=g(l);Q(r.$$.fragment,M),M.forEach(p),s=E(y),n=m(y,"DIV",{class:!0});var N=g(n);u=m(N,"DIV",{class:!0});var z=g(u);Q(o.$$.fragment,z),a=E(z),Q(_.$$.fragment,z),z.forEach(p),d=E(N),Q(i.$$.fragment,N),N.forEach(p),y.forEach(p),c=E(h),v&&v.l(h),T=E(h),F.l(h),L=E(h);const W=Le("svelte-5bpqvt",document.head);P=m(W,"META",{name:!0,content:!0}),W.forEach(p),this.h()},h(){b(l,"class","flex items-center"),b(u,"class","grid grid-cols-2"),b(n,"class","relative m-4"),b(t,"role","application"),b(t,"class","container mx-auto select-none border"),b(t,"tabindex","0"),document.title="Redux Fighting Game",b(P,"name","description"),b(P,"content","The world's simplest fighting game.")},m(h,y){C(h,t,y),f(t,l),X(r,l,null),f(t,s),f(t,n),f(n,u),X(o,u,null),f(u,a),X(_,u,null),f(n,d),X(i,n,null),C(h,c,y),v&&v.m(h,y),C(h,T,y),A[w].m(h,y),C(h,L,y),f(document.head,P),I=!0,V||(x=[G(t,"focus",e[4]),G(t,"keydown",e[5]),G(t,"keyup",e[6])],V=!0)},p(h,[y]){const M={};y&8&&(M.gameState=h[3]),r.$set(M);const N={};y&8&&(N.playerState=h[3].playerOneState),o.$set(N);const z={};y&8&&(z.playerState=h[3].playerTwoState),_.$set(z),h[1]?v?v.p(h,y):(v=we(h),v.c(),v.m(T.parentNode,T)):v&&(v.d(1),v=null);let W=w;w=U(h),w!==W&&(He(),K(A[W],1,1,()=>{A[W]=null}),Me(),F=A[w],F||(F=A[w]=D[w](h),F.c()),j(F,1),F.m(L.parentNode,L))},i(h){I||(j(r.$$.fragment,h),j(o.$$.fragment,h),j(_.$$.fragment,h),j(i.$$.fragment,h),j(F),I=!0)},o(h){K(r.$$.fragment,h),K(o.$$.fragment,h),K(_.$$.fragment,h),K(i.$$.fragment,h),K(F),I=!1},d(h){h&&(p(t),p(c),p(T),p(L)),Z(r),Z(o),Z(_),Z(i),v&&v.d(h),A[w].d(h),p(P),V=!1,Ee(x)}}}function bt(e,t,l){let r,s;ee(e,S,i=>l(3,r=i)),ee(e,Ce,i=>l(7,s=i));let n=!0,u=!1,o=!1;return setInterval(()=>{ne(S,r=Ze(r),r)},1e3/60),$e(()=>{ne(S,r.globals.paused=!0,r),l(1,u=s.url.searchParams.has("debug")),l(2,o=s.url.searchParams.has("rebind"))}),Re(()=>{ne(S,r=ie(r),r)}),[n,u,o,r,i=>l(0,n=!0),i=>{n&&Ge(r,i)},i=>{n&&Ue(r,i)}]}class wt extends re{constructor(t){super(),le(this,t,bt,_t,te,{})}}export{wt as component};

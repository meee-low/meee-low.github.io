var G=Object.defineProperty;var H=(o,t,e)=>t in o?G(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var S=(o,t,e)=>(H(o,typeof t!="symbol"?t+"":t,e),e);import{s as K,n as U,c as q,o as Q,r as Z}from"../chunks/scheduler.iXXlly_q.js";import{S as R,i as x,s as D,y as z,f as V,g as A,d,e as y,t as I,c as k,a as v,b as C,h as _,j,n as O,w as L,r as $,C as F}from"../chunks/index.CGXjPJL2.js";import{e as J}from"../chunks/each.Ci6CQDud.js";import{s as tt}from"../chunks/stores.Bf6lG0QP.js";import{p as et}from"../chunks/stores.C4QuwlqT.js";class T{constructor(t,e,r=0){S(this,"rows");S(this,"cols");S(this,"_impl");this.rows=t,this.cols=e,this._impl=Array(t*e).fill(r)}at(t,e){return this._impl[t*this.cols+e]}set(t,e,r){return this._impl[t*this.cols+e]=r,this}applyToCell(t,e,r){return this.set(t,e,r(this.at(t,e))),this}applyToAll(t){for(let e=0;e<this._impl.length;++e)this._impl[e]=t(this._impl[e]);return this}copy(){let t=new T(this.rows,this.cols);return t._impl=[...this._impl],t}shape(){return[this.rows,this.cols]}toArrayOfArrays(){let t=[];for(let e=0;e<this.rows;++e){t.push([]);for(let r=0;r<this.cols;++r)t[e].push(this.at(e,r))}return t}matMult(t,e=void 0){if(t.cols!==this.rows)throw new Error(`ValueError: Incompatible matrix dimensions. Left matrix has ${this.rows} rows but right matrix has ${t.cols} columns.`);if(e){if(e.rows!==this.rows||e.cols!==t.cols)throw new Error("ValueError: The result matrix has incompatible dimensions.")}else e=new T(this.rows,t.cols);for(let r=0;r<this.rows;++r)for(let s=0;s<t.cols;++s){let n=0;for(let l=0;l<this.cols;++l)n+=this.at(r,l)*t.at(l,s);e.set(r,s,n)}return e}static identity(t){const e=new T(t,t,0);for(let r=0;r<t;++r)for(let s=0;s<t;++s)r===s&&e.set(r,s,1);return e}scale(t){return this.applyToAll(e=>e*t)}static fromArray(t,e){if(t.length!==e[0]*e[1])throw new Error("ValueError: Incompatible dimensions.");const r=new T(e[0],e[1]);return r._impl=t,r}static fromArrayOfArrays(t){let e=new T(t.length,t[0].length);for(let r=0;r<t.length;++r){if(t[r].length!==t[0].length)throw new Error(`ValueError: row #${r} of this array has an invalid length. Expected ${t[0].length}, found ${t[r].length}.`);for(let s=0;s<t[r].length;++s)e.set(r,s,t[r][s])}return e}static rot2D(t){return T.fromArray([Math.cos(t),-Math.sin(t),Math.sin(t),Math.cos(t)],[2,2])}static rot2DDegrees(t){const r=t*.01745329251;return T.rot2D(r)}getRow(t){const e=t*this.cols;return this._impl.slice(e,e+this.cols)}getCol(t){let e=[];for(let r=0;r<this.rows;++r)e.push(this.at(r,t));return e}transpose(){if(this.rows!==this.cols)throw new Error("Needs to be a square matrix to transpose.");for(let t=0;t<this.cols;++t)for(let e=t+1;e<this.rows;++e)this.swap(t,e,e,t);return this}swap(t,e,r,s){const n=this.at(t,e),l=this.at(r,s);this.set(t,e,l),this.set(r,s,n)}transformVec2(t){if(this.cols!==2||this.rows!==2)throw new Error("Incompatible matrix size. Need a 2x2 matrix to operate on Vec2's.");const e=t.x*this.at(0,0)+t.y*this.at(0,1),r=t.x*this.at(1,0)+t.y*this.at(1,1);return t.x=e,t.y=r,t}}function rt(o){let e=new Array(o.rows).fill(1);for(let r=0;r<10;++r){e=lt(o,e);const s=st(e);for(let n=0;n<e.length;++n)e[n]/=s}return e}function st(o){return Math.pow(o.reduce((t,e)=>t*e,1),1/o.length)}function ot(o,t,e){const r=t[e];let s=0,n=0;for(let i=0;i<t.length;++i){if(i===e)continue;const a=t[i];s+=o.at(e,i)*a/(r+a),n+=o.at(i,e)/(r+a)}const l=1;return(s+l)/(n+l)}function lt(o,t){for(let e=0;e<t.length;++e)t[e]=ot(o,t,e);return t}function nt(o){let t=[];for(let e=0;e<o.rows;++e){const r=o.getRow(e).reduce((n,l)=>n+l,0)+1,s=o.getCol(e).reduce((n,l)=>n+l,0)+1;t.push(r/(r+s))}return t}class it{constructor(t){S(this,"elements");S(this,"comparisons");if(t.length<=1)throw new Error("Must have at least 2 elements to start ranking.");if(new Set(t).size!==t.length)throw new Error("Elements should all be distinct.");this.elements=t,this.comparisons=new T(this.elements.length,this.elements.length)}evaluate(t){return t(this.comparisons)}sortedElements(t){const e=this.evaluate(t);return this.elements.map((r,s)=>[r,e[s]]).sort(([,r],[,s])=>s-r).map(([r])=>r)}addComparison(t,e){const r=this.elements.indexOf(t),s=this.elements.indexOf(e);if(r<0||s<0)throw new Error("This pair was not found in the ranker.");this.comparisons.applyToCell(r,s,n=>n+1)}suggestComparison(){let t,e;try{[t,e]=at(this.elements.length)}catch{throw new Error("This should not happen.")}return[this.elements[t],this.elements[e]]}}function at(o){if(o<2)throw new Error(`Need at least 2, got ${o}.`);const t=Math.floor(Math.random()*o);let e;do e=Math.floor(Math.random()*o);while(e===t);return[t,e]}function ct(o){throw new Error("Not implemented")}const ht={elo:ct,winrate:nt,bradleyTerry:rt};function X(o,t,e){const r=o.slice();return r[17]=t[e],r}function ut(o){let t,e,r=o[4][0]+"",s,n,l,i=o[4][1]+"",a,p,w,h,m,N,E=J(o[6]),f=[];for(let c=0;c<E.length;c+=1)f[c]=M(X(o,E,c));return{c(){t=y("div"),e=y("button"),s=I(r),n=D(),l=y("button"),a=I(i),p=D(),w=y("div"),h=y("ul");for(let c=0;c<f.length;c+=1)f[c].c();this.h()},l(c){t=k(c,"DIV",{class:!0});var b=v(t);e=k(b,"BUTTON",{class:!0});var u=v(e);s=C(u,r),u.forEach(d),n=V(b),l=k(b,"BUTTON",{class:!0});var g=v(l);a=C(g,i),g.forEach(d),b.forEach(d),p=V(c),w=k(c,"DIV",{});var P=v(w);h=k(P,"UL",{});var W=v(h);for(let B=0;B<f.length;B+=1)f[B].l(W);W.forEach(d),P.forEach(d),this.h()},h(){O(e,"class","border p-2"),O(l,"class","border p-2"),O(t,"class","flex gap-2 px-[5vw]")},m(c,b){A(c,t,b),_(t,e),_(e,s),_(t,n),_(t,l),_(l,a),A(c,p,b),A(c,w,b),_(w,h);for(let u=0;u<f.length;u+=1)f[u]&&f[u].m(h,null);m||(N=[L(e,"click",o[11]),L(l,"click",o[12])],m=!0)},p(c,b){if(b&16&&r!==(r=c[4][0]+"")&&j(s,r),b&16&&i!==(i=c[4][1]+"")&&j(a,i),b&64){E=J(c[6]);let u;for(u=0;u<E.length;u+=1){const g=X(c,E,u);f[u]?f[u].p(g,b):(f[u]=M(g),f[u].c(),f[u].m(h,null))}for(;u<f.length;u+=1)f[u].d(1);f.length=E.length}},d(c){c&&(d(t),d(p),d(w)),$(f,c),m=!1,Z(N)}}}function ft(o){let t,e,r,s,n,l,i=o[7].interactive.ranker.sendButtonText+"",a,p,w;return{c(){t=y("form"),e=D(),r=y("label"),s=y("textarea"),n=D(),l=y("button"),a=I(i),this.h()},l(h){t=k(h,"FORM",{});var m=v(t);e=V(m),r=k(m,"LABEL",{});var N=v(r);s=k(N,"TEXTAREA",{rows:!0,cols:!0,class:!0}),v(s).forEach(d),N.forEach(d),n=V(m),l=k(m,"BUTTON",{class:!0});var E=v(l);a=C(E,i),E.forEach(d),m.forEach(d),this.h()},h(){O(s,"rows","5"),O(s,"cols","40"),O(s,"class","border"),O(l,"class","block rounded-md border p-2")},m(h,m){A(h,t,m),_(t,e),_(t,r),_(r,s),F(s,o[3]),_(t,n),_(t,l),_(l,a),p||(w=[L(s,"input",o[10]),L(l,"click",o[8])],p=!0)},p(h,m){m&8&&F(s,h[3]),m&128&&i!==(i=h[7].interactive.ranker.sendButtonText+"")&&j(a,i)},d(h){h&&d(t),p=!1,Z(w)}}}function M(o){let t,e=`${o[17]}`,r,s;return{c(){t=y("li"),r=I(e),s=D()},l(n){t=k(n,"LI",{});var l=v(t);r=C(l,e),s=V(l),l.forEach(d)},m(n,l){A(n,t,l),_(t,r),_(t,s)},p(n,l){l&64&&e!==(e=`${n[17]}`)&&j(r,e)},d(n){n&&d(t)}}}function Y(o){var l,i;let t,e,r=JSON.stringify({words:o[1],wordScores:o[5],ranker:{elements:(l=o[0])==null?void 0:l.elements,matrix:(i=o[0])==null?void 0:i.comparisons.toArrayOfArrays()}},null,2)+"",s,n;return{c(){t=y("pre"),e=I("  "),s=I(r),n=I(`
`)},l(a){t=k(a,"PRE",{});var p=v(t);e=C(p,"  "),s=C(p,r),n=C(p,`
`),p.forEach(d)},m(a,p){A(a,t,p),_(t,e),_(t,s),_(t,n)},p(a,p){var w,h;p&35&&r!==(r=JSON.stringify({words:a[1],wordScores:a[5],ranker:{elements:(w=a[0])==null?void 0:w.elements,matrix:(h=a[0])==null?void 0:h.comparisons.toArrayOfArrays()}},null,2)+"")&&j(s,r)},d(a){a&&d(t)}}}function pt(o){let t,e;function r(i,a){return i[0]?ut:ft}let s=r(o),n=s(o),l=o[2]&&Y(o);return{c(){n.c(),t=D(),l&&l.c(),e=z()},l(i){n.l(i),t=V(i),l&&l.l(i),e=z()},m(i,a){n.m(i,a),A(i,t,a),l&&l.m(i,a),A(i,e,a)},p(i,[a]){s===(s=r(i))&&n?n.p(i,a):(n.d(1),n=s(i),n&&(n.c(),n.m(t.parentNode,t))),i[2]?l?l.p(i,a):(l=Y(i),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:U,o:U,d(i){i&&(d(t),d(e)),n.d(i),l&&l.d(i)}}}function mt(o,t,e){let r,s,n,l;q(o,et,g=>e(13,n=g)),q(o,tt,g=>e(7,l=g));let i=!1;Q(()=>{e(2,i=n.url.searchParams.has("debug"))});let a;const p=ht.bradleyTerry;let w,h=[],m=["",""];function N(){e(1,h=w.split(",")),e(0,a=new it(h)),E()}function E(){a&&e(4,m=a.suggestComparison())}function f(g){a==null||a.addComparison(m[g],m[(g+1)%2]),e(0,a),E()}function c(){w=this.value,e(3,w)}const b=()=>f(0),u=()=>f(1);return o.$$.update=()=>{o.$$.dirty&3&&e(6,r=a?a.sortedElements(p):h),o.$$.dirty&3&&e(5,s=a?a.evaluate(p):h.map(g=>0))},[a,h,i,w,m,s,r,l,N,f,c,b,u]}class yt extends R{constructor(t){super(),x(this,t,mt,pt,K,{})}}export{yt as component};

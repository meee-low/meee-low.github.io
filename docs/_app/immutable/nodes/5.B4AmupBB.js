import{s as J,n as W,r as ie,c as ce,e as ue}from"../chunks/scheduler.D5QpUS1r.js";import{S as z,i as Q,e as k,s as O,c as p,r as _,d,v as D,a as f,y as M,b as V,w as n,q as P,u as x,x as L,l as S,m as G,g as de,n as U,A as X,t as Y,j,o as q}from"../chunks/index.BQpWWLdl.js";import{w as fe}from"../chunks/index.DdhBeCJx.js";const ne=2,he=10,ke=100/13,pe=ne/10,ve=3;let Z=fe({playerOneState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,keysHeld:new Set},playerTwoState:{status:"neutral",score:0,roundWon:0,blockStamina:100,attackCharge:0,parryFrames:0,keysHeld:new Set},globals:{roundCount:0,roundFrameCount:0}});function _e(e){if(e.playerOneState.attackCharge<100&&e.playerTwoState.attackCharge<100)return e;if(e.playerOneState.attackCharge>=100&&e.playerTwoState.attackCharge>=100)return e;let t=e.playerOneState.attackCharge>e.playerTwoState.attackCharge?1:2;return e=ye(e,t),e}function ee(e,t){if(t===1)return e.playerOneState;if(t===2)return e.playerTwoState;throw new Error("Invalid player id. Only 2 people play this game.")}function ye(e,t){let r=ee(e,t),a=ee(e,t%2+1);return a.parryFrames>0?(a.score+=1,e=ae(e)):a.status==="blocking"&&a.blockStamina>=0?a.blockStamina=Math.max(0,a.blockStamina-he):a.status==="neutral"&&(r.score+=1,e=ae(e)),r.attackCharge=0,e}function be(e){return e.keysHeld.has("def")&&e.keysHeld.has("atk")||!e.keysHeld.has("def")&&!e.keysHeld.has("atk")?(e.status="neutral",e.attackCharge=0):e.keysHeld.has("atk")?e.status="attacking":e.keysHeld.has("def")&&(e.attackCharge=0,e.status!=="blocking"&&(e.parryFrames=ve),e.blockStamina>0&&(e.status="blocking")),e}function oe(e,t,r){return["a","A","d","D","ArrowLeft","ArrowRight"].includes(t.key)&&(t.preventDefault(),e=r(e,t.key)),e}function ge(e,t){return oe(e,t,me)}function we(e,t){return oe(e,t,Ce)}function me(e,t){return t==="a"||t==="A"?e.playerOneState.keysHeld.add("def"):t==="d"||t==="D"?e.playerOneState.keysHeld.add("atk"):t==="ArrowLeft"?e.playerTwoState.keysHeld.add("atk"):t==="ArrowRight"&&e.playerTwoState.keysHeld.add("def"),e}function Ce(e,t){return(t==="a"||t==="A")&&e.playerOneState.keysHeld.delete("def"),(t==="d"||t==="D")&&e.playerOneState.keysHeld.delete("atk"),t==="ArrowLeft"&&e.playerTwoState.keysHeld.delete("atk"),t==="ArrowRight"&&e.playerTwoState.keysHeld.delete("def"),e}function $e(e){return e.status==="attacking"&&(e.attackCharge=Math.min(100,e.attackCharge+ke)),e}function Ae(e){return e.status==="blocking"&&(e.blockStamina=Math.max(0,e.blockStamina-ne),e.parryFrames=Math.max(0,e.parryFrames-1)),e}function Ee(e){return e.status!=="blocking"&&(e.blockStamina=Math.min(100,e.blockStamina+pe)),e}function te(e){return e={...e,attackCharge:0,blockStamina:100,parryFrames:0},e}function ae(e){return e={playerOneState:te(e.playerOneState),playerTwoState:te(e.playerTwoState),globals:{...e.globals,roundCount:e.globals.roundCount+1,roundFrameCount:0}},e}function N(e,t){return e={...e,playerOneState:t(e.playerOneState),playerTwoState:t(e.playerTwoState)},e}function Te(e){return e=N(e,be),e=N(e,Ee),e=N(e,$e),e=N(e,Ae),e=_e(e),e.globals.roundFrameCount+=1,e}function Oe(e){let t,r,a,h,o,i,w;return{c(){t=k("div"),r=k("div"),h=O(),o=k("div"),this.h()},l(l){t=p(l,"DIV",{class:!0});var c=_(t);r=p(c,"DIV",{class:!0,style:!0}),_(r).forEach(d),h=D(c),o=p(c,"DIV",{class:!0,style:!0}),_(o).forEach(d),c.forEach(d),this.h()},h(){f(r,"class",a=(e[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800"),M(r,"height",e[0].blockStamina+"%"),f(o,"class",i=(e[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800"),M(o,"height",e[0].attackCharge+"%"),f(t,"class",w=re(e[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")},m(l,c){V(l,t,c),n(t,r),n(t,h),n(t,o)},p(l,[c]){c&1&&a!==(a=(l[0].status==="blocking"?"":"invisible")+" absolute bottom-0 w-full bg-red-800")&&f(r,"class",a),c&1&&M(r,"height",l[0].blockStamina+"%"),c&1&&i!==(i=(l[0].status==="attacking"?"":"invisible")+" absolute bottom-0 w-full bg-sky-800")&&f(o,"class",i),c&1&&M(o,"height",l[0].attackCharge+"%"),c&1&&w!==(w=re(l[0].status)+" relative m-auto h-[200px] w-[200px] overflow-clip rounded-full")&&f(t,"class",w)},i:W,o:W,d(l){l&&d(t)}}}function re(e){return e==="blocking"||e==="blocking-start"?"bg-red-600":e==="attacking"?"bg-sky-500":"bg-yellow-400"}function De(e,t,r){let{playerState:a}=t;return e.$$set=h=>{"playerState"in h&&r(0,a=h.playerState)},[a]}class se extends z{constructor(t){super(),Q(this,t,De,Oe,J,{playerState:0})}}function He(e){let t,r,a,h,o=e[0].playerOneState.score+"",i,w,l,c=Math.round(e[0].globals.roundFrameCount/60)+"",g,m,A,F,C=e[0].playerTwoState.score+"",E,H,y,T,R,s;return{c(){t=k("div"),r=k("div"),a=k("p"),h=P("W:"),i=P(o),w=O(),l=k("p"),g=P(c),m=O(),A=k("p"),F=P("W:"),E=P(C),H=O(),y=k("div"),T=k("div"),R=O(),s=k("div"),this.h()},l(u){t=p(u,"DIV",{class:!0});var v=_(t);r=p(v,"DIV",{id:!0,class:!0});var b=_(r);a=p(b,"P",{class:!0});var $=_(a);h=x($,"W:"),i=x($,o),$.forEach(d),w=D(b),l=p(b,"P",{class:!0});var I=_(l);g=x(I,c),I.forEach(d),m=D(b),A=p(b,"P",{class:!0});var B=_(A);F=x(B,"W:"),E=x(B,C),B.forEach(d),b.forEach(d),H=D(v),y=p(v,"DIV",{class:!0});var K=_(y);T=p(K,"DIV",{class:!0,style:!0}),_(T).forEach(d),R=D(K),s=p(K,"DIV",{class:!0,style:!0}),_(s).forEach(d),K.forEach(d),v.forEach(d),this.h()},h(){f(a,"class","text-center"),f(l,"class","text-center"),f(A,"class","text-center"),f(r,"id","bar"),f(r,"class","grid w-full grid-cols-3"),f(T,"class","absolute h-10 w-6 bg-blue-500"),M(T,"left","calc("+le/6*100+"% - 12px)"),f(s,"class","absolute h-10 w-6 bg-orange-500"),M(s,"right","calc("+le/6*100+"% - 12px)"),f(y,"class","relative mx-8"),f(t,"class","min-h-20 w-full bg-gray-500 p-2")},m(u,v){V(u,t,v),n(t,r),n(r,a),n(a,h),n(a,i),n(r,w),n(r,l),n(l,g),n(r,m),n(r,A),n(A,F),n(A,E),n(t,H),n(t,y),n(y,T),n(y,R),n(y,s)},p(u,[v]){v&1&&o!==(o=u[0].playerOneState.score+"")&&L(i,o),v&1&&c!==(c=Math.round(u[0].globals.roundFrameCount/60)+"")&&L(g,c),v&1&&C!==(C=u[0].playerTwoState.score+"")&&L(E,C)},i:W,o:W,d(u){u&&d(t)}}}let le=0;function Fe(e,t,r){let{gameState:a}=t;return e.$$set=h=>{"gameState"in h&&r(0,a=h.gameState)},[a]}class Re extends z{constructor(t){super(),Q(this,t,Fe,He,J,{gameState:0})}}function Pe(e){let t,r,a,h,o,i,w,l,c,g,m,A="Debug:",F,C,E=JSON.stringify(e[0])+"",H,y,T,R;return a=new Re({props:{gameState:e[0]}}),i=new se({props:{playerState:e[0].playerOneState}}),l=new se({props:{playerState:e[0].playerTwoState}}),{c(){t=k("div"),r=k("div"),S(a.$$.fragment),h=O(),o=k("div"),S(i.$$.fragment),w=O(),S(l.$$.fragment),c=O(),g=k("div"),m=k("h2"),m.textContent=A,F=O(),C=k("p"),H=P(E),this.h()},l(s){t=p(s,"DIV",{role:!0,class:!0});var u=_(t);r=p(u,"DIV",{class:!0});var v=_(r);G(a.$$.fragment,v),v.forEach(d),h=D(u),o=p(u,"DIV",{class:!0});var b=_(o);G(i.$$.fragment,b),w=D(b),G(l.$$.fragment,b),b.forEach(d),u.forEach(d),c=D(s),g=p(s,"DIV",{});var $=_(g);m=p($,"H2",{class:!0,"data-svelte-h":!0}),de(m)!=="svelte-8uuk3j"&&(m.textContent=A),F=D($),C=p($,"P",{});var I=_(C);H=x(I,E),I.forEach(d),$.forEach(d),this.h()},h(){f(r,"class","flex items-center"),f(o,"class","grid grid-cols-2"),f(t,"role","application"),f(t,"class","container mx-auto border"),f(m,"class","max-w-[100vw]")},m(s,u){V(s,t,u),n(t,r),U(a,r,null),n(t,h),n(t,o),U(i,o,null),n(o,w),U(l,o,null),V(s,c,u),V(s,g,u),n(g,m),n(g,F),n(g,C),n(C,H),y=!0,T||(R=[X(window,"keydown",e[1]),X(window,"keyup",e[2])],T=!0)},p(s,[u]){const v={};u&1&&(v.gameState=s[0]),a.$set(v);const b={};u&1&&(b.playerState=s[0].playerOneState),i.$set(b);const $={};u&1&&($.playerState=s[0].playerTwoState),l.$set($),(!y||u&1)&&E!==(E=JSON.stringify(s[0])+"")&&L(H,E)},i(s){y||(Y(a.$$.fragment,s),Y(i.$$.fragment,s),Y(l.$$.fragment,s),y=!0)},o(s){j(a.$$.fragment,s),j(i.$$.fragment,s),j(l.$$.fragment,s),y=!1},d(s){s&&(d(t),d(c),d(g)),q(a),q(i),q(l),T=!1,ie(R)}}}function xe(e,t,r){let a;return ce(e,Z,i=>r(0,a=i)),setInterval(()=>{ue(Z,a=Te(a),a)},1e3/60),[a,i=>ge(a,i),i=>we(a,i)]}class Ke extends z{constructor(t){super(),Q(this,t,xe,Pe,J,{})}}export{Ke as component};

var G=Object.defineProperty;var H=(n,t,e)=>t in n?G(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var C=(n,t,e)=>(H(n,typeof t!="symbol"?t+"":t,e),e);import{s as K,n as U,c as Q,r as Y}from"../chunks/scheduler.iXXlly_q.js";import{S as Z,i as R,s as V,e as v,t as A,f as D,c as k,a as y,b as O,d as w,g as N,h as _,j as L,n as S,w as B,r as $,C as q}from"../chunks/index.CGXjPJL2.js";import{e as z}from"../chunks/each.Ci6CQDud.js";import{s as M}from"../chunks/stores.Bf6lG0QP.js";class T{constructor(t,e,s=0){C(this,"rows");C(this,"cols");C(this,"_impl");this.rows=t,this.cols=e,this._impl=Array(t*e).fill(s)}at(t,e){return this._impl[t*this.cols+e]}set(t,e,s){return this._impl[t*this.cols+e]=s,this}applyToCell(t,e,s){return this.set(t,e,s(this.at(t,e))),this}applyToAll(t){for(let e=0;e<this._impl.length;++e)this._impl[e]=t(this._impl[e]);return this}copy(){let t=new T(this.rows,this.cols);return t._impl=[...this._impl],t}shape(){return[this.rows,this.cols]}toArrayOfArrays(){let t=[];for(let e=0;e<this.rows;++e){t.push([]);for(let s=0;s<this.cols;++s)t[e].push(this.at(e,s))}return t}matMult(t,e=void 0){if(t.cols!==this.rows)throw new Error(`ValueError: Incompatible matrix dimensions. Left matrix has ${this.rows} rows but right matrix has ${t.cols} columns.`);if(e){if(e.rows!==this.rows||e.cols!==t.cols)throw new Error("ValueError: The result matrix has incompatible dimensions.")}else e=new T(this.rows,t.cols);for(let s=0;s<this.rows;++s)for(let r=0;r<t.cols;++r){let i=0;for(let o=0;o<this.cols;++o)i+=this.at(s,o)*t.at(o,r);e.set(s,r,i)}return e}static identity(t){const e=new T(t,t,0);for(let s=0;s<t;++s)for(let r=0;r<t;++r)s===r&&e.set(s,r,1);return e}scale(t){return this.applyToAll(e=>e*t)}static fromArray(t,e){if(t.length!==e[0]*e[1])throw new Error("ValueError: Incompatible dimensions.");const s=new T(e[0],e[1]);return s._impl=t,s}static fromArrayOfArrays(t){let e=new T(t.length,t[0].length);for(let s=0;s<t.length;++s){if(t[s].length!==t[0].length)throw new Error(`ValueError: row #${s} of this array has an invalid length. Expected ${t[0].length}, found ${t[s].length}.`);for(let r=0;r<t[s].length;++r)e.set(s,r,t[s][r])}return e}static rot2D(t){return T.fromArray([Math.cos(t),-Math.sin(t),Math.sin(t),Math.cos(t)],[2,2])}static rot2DDegrees(t){const s=t*.01745329251;return T.rot2D(s)}getRow(t){const e=t*this.cols;return this._impl.slice(e,e+this.cols)}getCol(t){let e=[];for(let s=0;s<this.rows;++s)e.push(this.at(s,t));return e}transpose(){if(this.rows!==this.cols)throw new Error("Needs to be a square matrix to transpose.");for(let t=0;t<this.cols;++t)for(let e=t+1;e<this.rows;++e)this.swap(t,e,e,t);return this}swap(t,e,s,r){const i=this.at(t,e),o=this.at(s,r);this.set(t,e,o),this.set(s,r,i)}transformVec2(t){if(this.cols!==2||this.rows!==2)throw new Error("Incompatible matrix size. Need a 2x2 matrix to operate on Vec2's.");const e=t.x*this.at(0,0)+t.y*this.at(0,1),s=t.x*this.at(1,0)+t.y*this.at(1,1);return t.x=e,t.y=s,t}}function x(n){let t=[];for(let e=0;e<n.rows;++e){const s=n.getRow(e).reduce((i,o)=>i+o,0)+1,r=n.getCol(e).reduce((i,o)=>i+o,0)+1;t.push(s/(s+r))}return t}class tt{constructor(t){C(this,"elements");C(this,"comparisons");if(t.length<=1)throw new Error("Must have at least 2 elements to start ranking.");if(new Set(t).size!==t.length)throw new Error("Elements should all be distinct.");this.elements=t,this.comparisons=new T(this.elements.length,this.elements.length)}evaluate(t){return t(this.comparisons)}sortedElements(t){const e=this.evaluate(t);return this.elements.map((s,r)=>[s,e[r]]).sort(([,s],[,r])=>r-s).map(([s])=>s)}addComparison(t,e){const s=this.elements.indexOf(t),r=this.elements.indexOf(e);if(s<0||r<0)throw new Error("This pair was not found in the ranker.");this.comparisons.applyToCell(s,r,i=>i+1)}suggestComparison(){let t,e;try{[t,e]=et(this.elements.length)}catch{throw new Error("This should not happen.")}return[this.elements[t],this.elements[e]]}}function et(n){if(n<2)throw new Error(`Need at least 2, got ${n}.`);const t=Math.floor(Math.random()*n);let e;do e=Math.floor(Math.random()*n);while(e===t);return[t,e]}function st(n){throw new Error("Not implemented")}const F={elo:st,winrate:x};function J(n,t,e){const s=n.slice();return s[14]=t[e],s}function rt(n){let t,e,s=n[3][0]+"",r,i,o,m=n[3][1]+"",d,h,E,u,l,f,b=z(n[5]),c=[];for(let a=0;a<b.length;a+=1)c[a]=X(J(n,b,a));return{c(){t=v("div"),e=v("button"),r=A(s),i=V(),o=v("button"),d=A(m),h=V(),E=v("div"),u=v("ul");for(let a=0;a<c.length;a+=1)c[a].c();this.h()},l(a){t=k(a,"DIV",{});var g=y(t);e=k(g,"BUTTON",{class:!0});var p=y(e);r=O(p,s),p.forEach(w),i=D(g),o=k(g,"BUTTON",{class:!0});var I=y(o);d=O(I,m),I.forEach(w),g.forEach(w),h=D(a),E=k(a,"DIV",{});var j=y(E);u=k(j,"UL",{});var P=y(u);for(let W=0;W<c.length;W+=1)c[W].l(P);P.forEach(w),j.forEach(w),this.h()},h(){S(e,"class","border p-2"),S(o,"class","border p-2")},m(a,g){N(a,t,g),_(t,e),_(e,r),_(t,i),_(t,o),_(o,d),N(a,h,g),N(a,E,g),_(E,u);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(u,null);l||(f=[B(e,"click",n[10]),B(o,"click",n[11])],l=!0)},p(a,g){if(g&8&&s!==(s=a[3][0]+"")&&L(r,s),g&8&&m!==(m=a[3][1]+"")&&L(d,m),g&32){b=z(a[5]);let p;for(p=0;p<b.length;p+=1){const I=J(a,b,p);c[p]?c[p].p(I,g):(c[p]=X(I),c[p].c(),c[p].m(u,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=b.length}},d(a){a&&(w(t),w(h),w(E)),$(c,a),l=!1,Y(f)}}}function ot(n){let t,e,s,r,i,o,m=n[6].interactive.ranker.sendButtonText+"",d,h,E;return{c(){t=v("form"),e=V(),s=v("label"),r=v("textarea"),i=V(),o=v("button"),d=A(m),this.h()},l(u){t=k(u,"FORM",{});var l=y(t);e=D(l),s=k(l,"LABEL",{});var f=y(s);r=k(f,"TEXTAREA",{rows:!0,cols:!0,class:!0}),y(r).forEach(w),f.forEach(w),i=D(l),o=k(l,"BUTTON",{class:!0});var b=y(o);d=O(b,m),b.forEach(w),l.forEach(w),this.h()},h(){S(r,"rows","5"),S(r,"cols","40"),S(r,"class","border"),S(o,"class","block rounded-md border p-2")},m(u,l){N(u,t,l),_(t,e),_(t,s),_(s,r),q(r,n[2]),_(t,i),_(t,o),_(o,d),h||(E=[B(r,"input",n[9]),B(o,"click",n[7])],h=!0)},p(u,l){l&4&&q(r,u[2]),l&64&&m!==(m=u[6].interactive.ranker.sendButtonText+"")&&L(d,m)},d(u){u&&w(t),h=!1,Y(E)}}}function X(n){let t,e=`${n[14]}`,s,r;return{c(){t=v("li"),s=A(e),r=V()},l(i){t=k(i,"LI",{});var o=y(t);s=O(o,e),r=D(o),o.forEach(w)},m(i,o){N(i,t,o),_(t,s),_(t,r)},p(i,o){o&32&&e!==(e=`${i[14]}`)&&L(s,e)},d(i){i&&w(t)}}}function nt(n){var E,u;let t,e,s,r=JSON.stringify({words:n[1],wordScores:n[4],ranker:{elements:(E=n[0])==null?void 0:E.elements,matrix:(u=n[0])==null?void 0:u.comparisons.toArrayOfArrays()}},null,2)+"",i,o;function m(l,f){return l[0]?rt:ot}let d=m(n),h=d(n);return{c(){h.c(),t=V(),e=v("pre"),s=A("  "),i=A(r),o=A(`
`)},l(l){h.l(l),t=D(l),e=k(l,"PRE",{});var f=y(e);s=O(f,"  "),i=O(f,r),o=O(f,`
`),f.forEach(w)},m(l,f){h.m(l,f),N(l,t,f),N(l,e,f),_(e,s),_(e,i),_(e,o)},p(l,[f]){var b,c;d===(d=m(l))&&h?h.p(l,f):(h.d(1),h=d(l),h&&(h.c(),h.m(t.parentNode,t))),f&19&&r!==(r=JSON.stringify({words:l[1],wordScores:l[4],ranker:{elements:(b=l[0])==null?void 0:b.elements,matrix:(c=l[0])==null?void 0:c.comparisons.toArrayOfArrays()}},null,2)+"")&&L(i,r)},i:U,o:U,d(l){l&&(w(t),w(e)),h.d(l)}}}function lt(n,t,e){let s,r,i;Q(n,M,a=>e(6,i=a));let o,m,d=[],h=["",""];function E(){e(1,d=m.split(",")),e(0,o=new tt(d)),u()}function u(){o&&e(3,h=o.suggestComparison())}function l(a){o==null||o.addComparison(h[a],h[(a+1)%2]),e(0,o),u()}function f(){m=this.value,e(2,m)}const b=()=>l(0),c=()=>l(1);return n.$$.update=()=>{n.$$.dirty&3&&e(5,s=o?o.sortedElements(F.winrate):d),n.$$.dirty&1&&e(4,r=o?o.evaluate(F.winrate):[0])},[o,d,m,h,r,s,i,E,l,f,b,c]}class ft extends Z{constructor(t){super(),R(this,t,lt,nt,K,{})}}export{ft as component};

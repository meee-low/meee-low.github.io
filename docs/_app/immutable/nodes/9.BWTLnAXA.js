var A=Object.defineProperty;var F=(o,s,t)=>s in o?A(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var r=(o,s,t)=>(F(o,typeof s!="symbol"?s+"":s,t),t);import{s as X,n as f,o as q,b as v}from"../chunks/scheduler.iXXlly_q.js";import{S as C,i as R,e as H,c as T,a as D,d as y,g as Q}from"../chunks/index.CGXjPJL2.js";import{M as _,a as E,b as V,V as d,c as I,S as L,O as N,W as z}from"../chunks/three.module.DGVNqpL6.js";import{a as S}from"../chunks/utils.B7PvQ2PK.js";function x(o,s){const t=o.x-s.x,e=o.y-s.y;return t*t+e*e}class B{}class l extends B{constructor(t,e,i,n){super();r(this,"centerX");r(this,"centerY");r(this,"width");r(this,"height");this.centerX=t,this.centerY=e,this.width=i,this.height=n}static fromTopLeft(t,e,i,n){return new l(t+i/2,e+n/2,i,n)}leftX(){return this.centerX-this.width/2}rightX(){return this.centerX+this.width/2}topY(){return this.centerY-this.height/2}bottomY(){return this.centerY+this.height/2}debugDirections(){return{left:this.leftX(),right:this.rightX(),top:this.topY(),bottom:this.bottomY()}}contains(t){const e=t.x,i=t.y;return this.leftX()<=e&&this.rightX()>=e&&this.topY()<=i&&this.bottomY()>=i}intersects(t){if(t instanceof l)return!(this.leftX()>t.rightX()||t.leftX()>this.rightX()||this.topY()>t.bottomY()||t.topY()>this.bottomY());if(t instanceof u){if(this.contains(t.center))return!0;const e={x:Math.max(this.leftX(),Math.min(this.rightX(),t.center.x)),y:Math.max(this.topY(),Math.min(this.bottomY(),t.center.y))};return x(t.center,e)<t.radius*t.radius}S(t)}closestBoundaryPointToPoint(t,e){e.x=Math.max(this.leftX(),Math.min(t.x,this.rightX())),e.y=Math.max(this.topY(),Math.min(t.y,this.bottomY()))}sqDistanceToPoint(t){const e={x:0,y:0};this.closestBoundaryPointToPoint(t,e);const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}}class u extends B{constructor(t,e){super();r(this,"center");r(this,"radius");this.center=t,this.radius=e}contains(t){return x(this.center,t)<this.radius*this.radius}intersects(t){if(t instanceof u){const e=this.radius+t.radius,i=e*e;return x(this.center,t.center)<i}if(t instanceof l)return t.intersects(this);S(t)}closestBoundaryPointToPoint(t,e){const i=t.x-this.center.x,n=t.y-this.center.y,a=Math.sqrt(i*i+n*n);a<=1e-4&&(e.x=this.center.x,e.y=this.center.y);const c=this.radius/a;e.x=this.center.x+t.x*c,e.y=this.center.y+t.y*c}sqDistanceToPoint(t){const e=t.x-this.center.x,i=t.y-this.center.y,n=e*e+i*i;return Math.pow(Math.sqrt(n)-this.radius,2)}}class G{}class w extends G{constructor(t){super();r(this,"elements",[]);r(this,"accessFunc");this.accessFunc=t}push(t){this.elements.push(t)}query(t){return this.elements.filter(e=>t.contains(this.accessFunc(e)))}queryAll(){return this.elements}rebalance(){}}const W={maxSpeed:3,minSpeed:2,neighborRange:20,protectedRange:2,obstacleRange:50,cohesionFactor:5e-4,separationFactor:.05,alignmentFactor:.05,turnFactor:.2};class j{constructor(s,t,e,i={}){r(this,"tooCloseBBox");r(this,"neighborsBBox");r(this,"position");r(this,"heading");r(this,"futureHeading");r(this,"params");r(this,"id");this.id=s,this.position=t,this.heading=e,this.futureHeading=e,this.params={...W,...i},this.tooCloseBBox=new u(t,this.params.protectedRange),this.neighborsBBox=new u(t,this.params.neighborRange)}move(){this.heading=this.futureHeading.clampLength(this.params.minSpeed,this.params.maxSpeed),this.position.add(this.heading),this.tooCloseBBox.center=this.position,this.neighborsBBox.center=this.position}getNewHeading(s){this.futureHeading.set(0,0);let t=s.boidsQt.query(this.tooCloseBBox),e=s.boidsQt.query(this.neighborsBBox),i=new d(0,0);t.forEach(h=>{i.add(this.position).sub(h.position)});let n=new d(0,0);e.length>0&&(e.forEach(h=>{n.add(h.heading)}),n.divideScalar(e.length));let a=new d(0,0);e.length>0&&(e.forEach(h=>{a.add(h.position)}),a.divideScalar(e.length));let c=new d(0,0);this.position.x<s.worldArea.leftX()+this.params.obstacleRange&&(c.x+=this.params.turnFactor),this.position.x>s.worldArea.rightX()-this.params.obstacleRange&&(c.x-=this.params.turnFactor),this.position.y<s.worldArea.topY()+this.params.obstacleRange&&(c.y+=this.params.turnFactor),this.position.y>s.worldArea.bottomY()-this.params.obstacleRange&&(c.y-=this.params.turnFactor),s.obstacles.forEach(h=>{h.sqDistanceToPoint(this.position)}),this.futureHeading.addScaledVector(i,this.params.separationFactor),this.futureHeading.addScaledVector(n,this.params.alignmentFactor),this.futureHeading.addScaledVector(a,this.params.cohesionFactor),this.futureHeading.addScaledVector(c,this.params.turnFactor),this.futureHeading.clampLength(this.params.minSpeed,this.params.maxSpeed)}getPosition(){return this.position}updateParams(s){s.neighborRange&&(this.neighborsBBox.radius=s.neighborRange),s.protectedRange&&(this.tooCloseBBox.radius=s.protectedRange),this.params={...this.params,...s}}}class k{constructor(s,t,e,i){r(this,"QT_CAPACITY",3);r(this,"boidsQt");r(this,"boidsSprites",[]);r(this,"worldArea");r(this,"obstacles",[]);r(this,"curId",0);this.worldArea=new l(s,t,e,i),this.boidsQt=new w(n=>n.getPosition())}addBoid(s,t){let e=new j(this.curId++,s,t);this.boidsQt.push(e);let i=$();const n=new _({color:16711680});let a=new E(i,n);a.position.x=s.x,a.position.y=s.y,a.rotateZ(t.angle()),this.boidsSprites.push(a)}updateHeadings(){this.boidsQt.queryAll().forEach(s=>{s.getNewHeading(this)})}move(){let s=new w(t=>t.getPosition());this.boidsQt.queryAll().forEach(t=>{t.move(),s.push(t),this.boidsSprites[t.id].position.x=t.getPosition().x,this.boidsSprites[t.id].position.y=t.getPosition().y,console.log({id:t.id,position:{x:t.getPosition().x,y:t.getPosition().y}})}),this.boidsQt=s}update(){this.updateHeadings(),this.move()}}function $(o,s){let t=new V;const e=0,i=0,n=Math.cos(Math.PI/6);let a=new d(e,i+1),c=new d(e-n,i-2),h=new d(e+n,i-2);return t.moveTo(a.x,a.y),t.lineTo(c.x,c.y),t.lineTo(h.x,h.y),new I(t)}function O(o,s,t,e=2){let i=new L;const n=o/s,a=s/e;let c=new N(-a*n/2,a*n/2,a/2,-a/2,1,1e3);c.position.z=10;let h=new z({canvas:t});return h.setSize(o,s),{scene:i,camera:c,renderer:h}}function U(o,s,t,e){const i=()=>{requestAnimationFrame(i),o({camera:e,scene:t,renderer:s}),s.render(t,e)};return i}function Z(o){let s;return{c(){s=H("canvas")},l(t){s=T(t,"CANVAS",{}),D(s).forEach(y)},m(t,e){Q(t,s,e),o[1](s)},p:f,i:f,o:f,d(t){t&&y(s),o[1](null)}}}function J(o,s,t){let e,i,n,a,c,h,m;q(()=>{c=600,h=400,{camera:i,renderer:n,scene:a}=O(c,h,e),console.log("camera boundaries: ",{top:i.top,bottom:i.bottom,left:i.left,right:i.right}),m=new k(0,0,i.right-i.left,i.top-i.bottom);for(let g=0;g<20;++g){let M=Math.random()*(i.right-i.left)+i.left,Y=Math.random()*(i.top-i.bottom)+i.bottom,b=new d(M,Y);console.log(b),m.addBoid(b,new d(Math.random(),Math.random()))}a.add(...m.boidsSprites),U(g=>m.update(),n,a,i)()});function P(p){v[p?"unshift":"push"](()=>{e=p,t(0,e)})}return[e,P]}class nt extends C{constructor(s){super(),R(this,s,J,Z,X,{})}}export{nt as component};
